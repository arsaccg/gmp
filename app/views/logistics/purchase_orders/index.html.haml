#content-inside
  .row
    .col-xs-12.col-sm-7.col-md-7.col-lg-3
      %h1.page-title.txt-color-blueDark{ "style" => "margin-bottom: 10px;"}
        %i.fa.fa-pencil-square-o.fa-fw
        Ordenes de Compra
    - if @deliveryOrders != nil && @deliveryOrder != nil
      .col-sm-3{ "style" => "margin-top: 10px;" }
        %a.btn.btn-primary.btn-mini{:onclick => "javascript:load_url_ajax('#{new_logistics_purchase_order_path}', 'content', {company_id: #{@company}}, null, 'GET')"}
          Agregar Nueva Orden de Compra
    - if flash[:notice] != nil
      .alert.alert-success.fade.in{"style" => "clear:both"}
        %button.close{"data-dismiss" => "alert"}
          ×
        %i.fa-fw.fa.fa-check
        %strong Éxito
        = flash[:notice]
    - if flash[:error] != nil
      .alert.alert-danger.fade.in
        %button.close{"data-dismiss" => "alert"}
          ×
        %i.fa-fw.fa.fa-times
        %strong Error!
        = flash[:error]
  - if @deliveryOrders == nil
    .alert.alert-block.alert-danger
      %a.close(data-dismiss="alert" href="#")
        ×
      %h4.alert-heading
        %i.fa.fa-lock
          No puedes crear Ordenes de Compra!
      %p
        Verifica si tienes, por lo menos, 1 Orden de Suministro generada y aprobada.
  %br
  .row
    .col-xs-12.col-sm-7.col-md-7.col-lg-4
      %div
        .smart-form
          %section
            %label.label Selecciona el centro de costo para ver su información
            %label.select
              %select{ 'name' => 'cost_center_id', 'id' => 'cost-center-selected' }
                - @costcenters.each do |cc|
                  %option{'value' => "#{cc.id}"}= cc.name
              %i
  #widget-grid
    .row
      %article.col-xs-12.col-sm-12.col-md-12.col-lg-12
        = render :partial => 'table'

:javascript

  // DO NOT REMOVE : GLOBAL FUNCTIONS!
  pageSetUp();
  
  // PAGE RELATED SCRIPTS
  $(document).ready(function(){

    $("#cost-center-selected").focus();
    
    load_items_delivery_order_ajax('#{show_rows_purchase_orders_logistics_purchase_orders_path}', 'body-summary-purchase-orders', {company_id: '#{@company}', cost_center_id: $("#cost-center-selected").val(), authenticity_token: "#{form_authenticity_token}"});

    $('#cost-center-selected').change(function(){
      load_items_delivery_order_ajax('#{show_rows_purchase_orders_logistics_purchase_orders_path}', 'body-summary-purchase-orders', {company_id: '#{@company}', cost_center_id: this.value, authenticity_token: "#{form_authenticity_token}"});

      $('#summary-purchase-orders tr td a').tooltip('hide');
    });

  });

  loadDataTableScripts();
  function loadDataTableScripts() {

    loadScript("#{ asset_path 'plugin/datatables/jquery.dataTables-cust.min', type: :javascript }", dt_2);

    function dt_2() {
      loadScript("#{ asset_path 'plugin/datatables/ColReorder.min', type: :javascript }", dt_3);
    }

    function dt_3() {
      loadScript("#{ asset_path 'plugin/datatables/FixedColumns.min.js', type: :javascript }", dt_4);
    }

    function dt_4() {
      loadScript("#{ asset_path 'plugin/datatables/ColVis.min', type: :javascript }", dt_5);
    }

    function dt_5() {
      loadScript("#{ asset_path 'plugin/datatables/ZeroClipboard', type: :javascript }", dt_6);
    }

    function dt_6() {
      loadScript("#{ asset_path 'plugin/datatables/media/js/TableTools.min', type: :javascript }", dt_7);
    }

    function dt_7() {
      loadScript("#{ asset_path 'plugin/datatables/DT_bootstrap', type: :javascript }", runDataTables);
    }

  }

  function runDataTables() {

    /*
     * BASIC
     */
    $('#summary-purchase-orders').dataTable({
      "sPaginationType" : "bootstrap_full"
    });

    /* END BASIC */

    $('#summary-purchase-orders_wrapper').removeClass("dataTables_wrapper");

    /* Add the events etc before DataTables hides a column */
    $("#summary-purchase-orders thead input").keyup(function() {
      oTable.fnFilter(this.value, oTable.oApi._fnVisibleToColumnIndex(oTable.fnSettings(), $("thead input").index(this)));
    });

    $("#summary-purchase-orders thead input").each(function(i) {
      this.initVal = this.value;
    });
    $("#summary-purchase-orders thead input").focus(function() {
      if (this.className == "search_init") {
        this.className = "";
        this.value = "";
      }
    });
    $("#summary-purchase-orders thead input").blur(function(i) {
      if (this.value == "") {
        this.className = "search_init";
        this.value = this.initVal;
      }
    });
  }