#content-inside
  .row
    .col-md-12.col-sm-7.col-md-7.col-lg-4
      %h1.page-title.txt-color-blueDark
        %i.fa.fa-pencil-square-o.fa-fw 
        Enlazar Presupuestos
  - if @message_error == ''
    
    .row
      .col-md-12
        .content-load
          .items-panel
            %table(class=" table-bordered table-hover white-table small-font table-condensed " width="100%")
              %thead
                %tr
                  %th Partidas Meta
                  %th Metrado
                  %th Precio
              %tbody
                - result_credit = get_credit(@goalitembybudgets[0].budget_id)
                - itemwbs = itemswbs_from_budget(@goalitembybudgets[0].budget_id)
                - @goalitembybudgets.each do |itembudget|
                  - title = get_title_or_description(itembudget)
                  - amount_str = ""
                  - if  itembudget.item_id != nil
                    - meas_i = number_with_precision(itembudget.measured.to_f, :precision => 2)
                    - cred_i = number_with_precision(result_credit[itembudget.item_code + itembudget.order], :precision => 2)
                    - amount = meas_i.to_f - cred_i.to_f
                    - amount_str = get_color_class(amount.to_s, itemwbs[itembudget.id])
                  - else 
                    - amount_str = "color-title"
                  %tr{:id=>"item_" + itembudget.id.to_s, :class=> amount_str}
                    %td 
                      = "---" * (itembudget.order.length/3).to_i
                      = itembudget.order        
                      -if itembudget.measured.to_f > 0
                        -title_parsed = URI.escape(title.gsub('\'', '_'))
                        %a{:href=>"javascript:add_item2('#{itembudget.id.to_s}')"}
                          = title
                      -else
                        %strong
                          = title
                    -if itembudget.measured.to_f > 0
                      %td(style="text-align: right;")
                        = number_with_delimiter(number_with_precision itembudget.measured.to_f, :precision => 2)
                      %td(style="text-align: right;") 
                        = number_to_currency(number_with_precision(itembudget.price, :precision => 2).to_s , :unit=>'S/. ') rescue ""
                    -else
                      %td(colspan="2")
    %br
    .row
      .col-md-4
        .content-load
          .items-panel
            %table(class=" table-bordered table-hover white-table small-font table-condensed " width="100%")
              %thead
                %tr
                  %th Partidas Venta 
              %tbody
                - result_credit = get_credit(@saleitembybudgets[0].budget_id)
                - itemwbs = itemswbs_from_budget(@saleitembybudgets[0].budget_id)
                - @saleitembybudgets.each do |itembudget|
                  - title = get_title_or_description(itembudget)
                  - amount_str = ""
                  - if  itembudget.item_id != nil
                    - meas_i = number_with_precision(itembudget.measured.to_f, :precision => 2)
                    - cred_i = number_with_precision(result_credit[itembudget.item_code + itembudget.order], :precision => 2)
                    - amount = meas_i.to_f - cred_i.to_f
                    - amount_str = get_color_class(amount.to_s, itemwbs[itembudget.id])
                  - else 
                    - amount_str = "color-title"
                  %tr{:id=>"item_" + itembudget.id.to_s, :class=> amount_str}
                    %td 
                      = "---" * (itembudget.order.length/3).to_i
                      = itembudget.order        
                      -if itembudget.measured.to_f > 0
                        -title_parsed = URI.escape(title.gsub('\'', '_'))
                        %a{:href=>"javascript:selectitem('#{itembudget.id.to_s}');", :ondblclick=>"javascript:load_item(#{itembudget.to_json}, '#{title_parsed}');"}
                          = title
                      -else
                        %strong
                          = title
      .col-md-8
        %table.has-tickbox(class="table table-condensed table-bordered table-striped table-hover dataTable" style="font-size: 12px;" id="summary-workers" aria-describedby="data-table_info")
          %thead
            %tr
              %th(colspan="2") Partidas Meta Seleccionadas
              %th Total
              %th Porcentaje
              %th Guardar
              %th Eliminar
          %tbody(id="items_table2")


  %button.btn.btn-sm.btn-primary.btn-prev#backlist-entity{type: "button"}
    %i.fa.fa-arrow-left>
    Retornar al listado

  
:javascript

  $(".content-load").height($(document).height()-600);
  $(".botom-load").height(200);
  $(document).ready(function (){
    $('select').select2({width:'280px'});
  });

  function add_item(elemento){
    str_item = {authenticity_token: "#{form_authenticity_token}", item_id: elemento};

    append_url_ajax('#{add_item_management_equivalence_of_items_path}', 'items_table', str_item, 0, 'POST');
  }

  function add_item2(elemento){
    str_item = {authenticity_token: "#{form_authenticity_token}", item_id: elemento};

    append_url_ajax('#{add_item2_management_equivalence_of_items_path}', 'items_table2', str_item, 0, 'POST');
  }

  function add_item3(elemento,porcentaje){
    percent = document.getElementById("equivalence_of_items_goalitembybudget_"+porcentaje+"_percentage").value;
    str_item = {authenticity_token: "#{form_authenticity_token}", sale_id: elemento, target_id: $('#saleitembybudget_item').val(), percentage: percent};

    append_url_ajax('#{link_budget_method_management_equivalence_of_items_path}', 'items_table2', str_item, 0, 'POST');
  }

  $('#backlist-entity').click(function(){
    load_url_ajax("#{management_equivalence_of_items_path}", 'content', null, null, 'GET');
  });