%table(class="table table-hover white-table small-font table-light"  id="scroll-table" width="100%")
  %thead
    %th(colspan="3") 
      %strong Partidas
    %th
      %strong Unidad
    %th
      %strong Metrado
    %th
      %strong Costo 
    %th
      %strong Total 
  %tbody
    - @itembybudgets.each do |itembudget|
      - order_str = itembudget.order.gsub(".","d")
      - @var_partial = number_with_precision(get_cost_partial(itembudget.order).to_f, :precision => 2).to_s
      - if itembudget.order.length < 3
        %tr(id="master_#{itembudget.order.gsub('.','d')}")
          - @var_cost = number_with_precision(get_total_cost(itembudget.order, itembudget.budget_id).to_f, :precision => 2).to_s
          %td
            %strong
              %a.red(href="javascript:toogle_detail('#{itembudget.order}');")
                =itembudget.order
          %td(colspan="2")
            %a.red{:href=>"javascript:filter_by_budget_and_item('#{itembudget.order.gsub('.','d')}', '" + filter_by_budget_and_item_management_inputbybudgetanditems_path.to_s + "?budget_id=" + @budget_id + "&item_id=" + itembudget.item_id.to_s + "&order=" + order_str + "');"}
              %strong
                = get_title_or_description(itembudget)
            %a{href: "javascript:load_url_ondiv('#{edit_management_itembybudget_path(itembudget)}', 'right-area')"}
              %i.fa.fa-pencil
          %td(colspan="4" style="text-align: right;")
            - if itembudget.measured.to_i == 0 
              %strong.red
                = number_to_currency(@var_cost, :unit=>'S/.')
      - else 
        %tr(id="detail_#{itembudget.order.gsub('.','d')}")
          %td(colspan="2") 
          %td
            - n = (itembudget.order.length / 3).to_i
            -for i in 3..n
              %span(style="padding-left: 20px;")
            =itembudget.order
            - measured = 0
            - if itembudget.measured.to_f != 0
              - measured = itembudget.measured
            %a{:href=>"javascript:filter_by_budget_and_item('#{itembudget.order.gsub('.','d')}', '" + filter_by_budget_and_item_management_inputbybudgetanditems_path.to_s + "?budget_id=" + @budget_id.to_s + "&item_id=" + itembudget.item_id.to_s + "&order=" + order_str + "&measured=" + measured.to_s + "');", class: measured == 0 ? "green" : ""}
              = get_title_or_description(itembudget)
            %a{href: "javascript:load_url_ondiv('#{edit_management_itembybudget_path(itembudget)}', 'right-area')"}
              %i.fa.fa-pencil
          - if itembudget.measured.to_f == 0
            - @var_cost = number_with_precision(get_total_cost(itembudget.order, itembudget.budget_id).to_f, :precision => 2).to_s
            %td(colspan="4" style="text-align: right;") 
              %strong.green
                = number_to_currency(@var_cost, :unit=>'S/.')
          - else
            %td(style="text-align: right;")
              = itembudget.unit.to_s
            %td(style="text-align: right;")
              = number_with_precision(itembudget.measured, :precision => 2)
            %td(style="text-align: right;")
              -# data =  #Wbsitem.get_brief(nil, itembudget.budget_id, itembudget.order)
              - price =  get_sumatory_one_to_one(itembudget.order, itembudget.budget_id) #data[0].round(2) + data[1].round(2) + data[2].round(2) + data[3].round(2)
              = number_to_currency(number_with_precision(price, :precision => 2), :unit=>'S/.')

            %td(style="text-align: right;")
              %strong(style="text-align: right;")
                = number_to_currency(price.to_f * itembudget.measured.to_f, :unit=>'S/.')
          
:javascript
  var selected_item = '';

  function toogle_detail(code){ 
    $("[id^='detail_" +  code +"']" ).slideToggle("slow");
  } 

  function filter_by_budget_and_item(item, str){
    selectitem(item);

    $('#articles-t').html(''); 
    load_url_ondiv(str, 'botom-load');
  }

  function selectitem(item){
    $("#detail_" + selected_item).removeClass("info");
    $("#master_" + selected_item).removeClass("info");
    selected_item = item;
    $("#detail_" + item).addClass("info"); 
    $("#master_" + item).addClass("info"); 
  }




