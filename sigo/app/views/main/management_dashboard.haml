%section#widget-grid
  / row
  .row
    %article.col-xs-12.col-sm-12.col-md-12.col-lg-12
      / new widget
      #wid-id-3.jarviswidget{"data-widget-colorbutton" => "false", "data-widget-deletebutton" => "false", "data-widget-editbutton" => "false", "data-widget-fullscreenbutton" => "false", "data-widget-togglebutton" => "false"}
        %header
          %h2 Lista de Centro de costos
          %ul#myTab.nav.nav-tabs.pull-right.in
            %li.active
              %a{"data-toggle" => "tab", :href => "#c1"}
                %span.hidden-mobile.hidden-tablet Saneamiento
            %li
              %a{"data-toggle" => "tab", :href => "#c2"}
                %span.hidden-mobile.hidden-tablet Eléctrico
            %li
              %a{"data-toggle" => "tab", :href => "#c3"}
                %span.hidden-mobile.hidden-tablet Civil   
            %li
              %a{"data-toggle" => "tab", :href => "#c4"}
                %span.hidden-mobile.hidden-tablet Administración                    
        / widget div
        .widget-body
          #myTabContent.tab-content
            #c1.tab-pane.fade.active.in
              %table.table.table-striped.table-hover.table-condensed
                %thead
                  %tr
                    %th N° de C.C.
                    %th Compañia
                    %th Centro de Costo
                    %th G.D.G.
                    %th 
                      Movimientos
                      %span
                        %a.btn.btn-default.btn-xs{:href => "#{report_pdf_general_expenses_loans_path}.pdf", :target => "_blank"}
                          %i.fa.fa-book
                      %span
                        %a.btn.btn-default.btn-xs{:href => "#{bidimensional_report_pdf_general_expenses_loans_path}.pdf", :target => "_blank"}
                          2D                          
                    %th{"style"=>"width:30px;"} Resultados Operativos
                %tbody
                  -if @saneamiento!=nil
                    - @saneamiento.each do |cc|
                      %tr
                        %td= cc.code.to_s
                        %td= cc.company.short_name.to_s
                        %td
                          %a{href: 'javascript:void(0);', :onclick => 'goCoordinatesGMap(' + cc.latitude.to_s + ', ' + cc.longitude.to_s + ');', title: "Geolocalizacion"}
                            %i.fa.fa-adn
                          %a{"style"=>"display:inline;margin-right:5px;",href: 'javascript:void(0);', :onclick => 'detail('+cc.id.to_s+');', title: "Datos generales del centro de costo"}
                            %i.fa.fa-info-circle
                          %div{"style"=>"display:inline;margin-right:5px;"}= cc.name.to_s
                        %td
                          %span
                            %a.btn.btn-default.btn-xs{href: 'javascript:void(0);', :onclick => 'gdg('+cc.id.to_s+');'}
                              %i.fa.fa-folder-open
                        %td
                          %span
                            %a.btn.btn-default.btn-xs{href: 'javascript:void(0);', :onclick => 'loan('+cc.id.to_s+');'}
                              %i.fa.fa-folder-open
                          %span
                            %a.btn.btn-default.btn-xs{href: 'javascript:void(0);', :onclick => 'bond_letter('+cc.id.to_s+');'}
                              Cartas Fianza                                
                        %td
                          %span
                            %a.btn.btn-default.btn-xs{href: 'javascript:void(0);', :onclick => 'load_operating_result('+cc.id.to_s+');'}
                              %i.fa.fa-usd

                  - else
                    = ""

            #c2.tab-pane.fade
              %table.table.table-striped.table-hover.table-condensed
                %thead
                  %tr
                    %th N° de C.C.
                    %th Compañia
                    %th Centro de Costo
                    %th G.D.G.
                    %th 
                      Movimientos
                      %span
                        %a.btn.btn-default.btn-xs{:href => "#{report_pdf_general_expenses_loans_path}.pdf", :target => "_blank"}
                          %i.fa.fa-book
                      %span
                        %a.btn.btn-default.btn-xs{:href => "#{bidimensional_report_pdf_general_expenses_loans_path}.pdf", :target => "_blank"}
                          2D
                    %th{"style"=>"width:30px;"} Resultados Operativos
                %tbody
                  -if @electrico!=nil
                    - @electrico.each do |cc|
                      %tr
                        %td= cc.code.to_s
                        %td= cc.company.short_name.to_s
                        %td
                          %a{href: 'javascript:void(0);', :onclick => 'goCoordinatesGMap(' + cc.latitude.to_s + ', ' + cc.longitude.to_s + ');', title: "Geolocalizacion"}
                            %i.fa.fa-adn
                          %a{"style"=>"display:inline;margin-right:5px;",href: 'javascript:void(0);', :onclick => 'detail('+cc.id.to_s+');', title: "Datos generales del centro de costo"}
                            %i.fa.fa-info-circle
                          %div{"style"=>"display:inline;margin-right:5px;"}= cc.name.to_s
                        %td
                          %span
                            %a.btn.btn-default.btn-xs{href: 'javascript:void(0);', :onclick => 'gdg('+cc.id.to_s+');'}
                              %i.fa.fa-folder-open
                        %td
                          %span
                            %a.btn.btn-default.btn-xs{href: 'javascript:void(0);', :onclick => 'loan('+cc.id.to_s+');'}
                              %i.fa.fa-folder-open
                          %span
                            %a.btn.btn-default.btn-xs{href: 'javascript:void(0);', :onclick => 'bond_letter('+cc.id.to_s+');'}
                              Cartas Fianza                              
                        %td
                          %span
                            %a.btn.btn-default.btn-xs{href: 'javascript:void(0);', :onclick => 'load_operating_result('+cc.id.to_s+');'}
                              %i.fa.fa-usd

                  - else
                    = ""
            / end s2 tab pane
            #c3.tab-pane.fade
              %table.table.table-striped.table-hover.table-condensed
                %thead
                  %tr
                    %th N° de C.C.
                    %th Compañia
                    %th Centro de Costo
                    %th G.D.G.
                    %th 
                      Movimientos
                      %span
                        %a.btn.btn-default.btn-xs{:href => "#{report_pdf_general_expenses_loans_path}.pdf", :target => "_blank"}
                          %i.fa.fa-book
                      %span
                        %a.btn.btn-default.btn-xs{:href => "#{bidimensional_report_pdf_general_expenses_loans_path}.pdf", :target => "_blank"}
                          2D                          
                    %th{"style"=>"width:30px;"} Resultados Operativos
                %tbody
                  -if @cost_centers!=nil
                    - @civil.each do |cc|
                      %tr
                        %td= cc.code.to_s
                        %td= cc.company.short_name.to_s
                        %td
                          %a{href: 'javascript:void(0);', :onclick => 'goCoordinatesGMap(' + cc.latitude.to_s + ', ' + cc.longitude.to_s + ');', title: "Geolocalizacion"}
                            %i.fa.fa-adn
                          %a{"style"=>"display:inline;margin-right:5px;",href: 'javascript:void(0);', :onclick => 'detail('+cc.id.to_s+');', title: "Datos generales del centro de costo"}
                            %i.fa.fa-info-circle
                          %div{"style"=>"display:inline;margin-right:5px;"}= cc.name.to_s
                        %td
                          %span
                            %a.btn.btn-default.btn-xs{href: 'javascript:void(0);', :onclick => 'gdg('+cc.id.to_s+');'}
                              %i.fa.fa-folder-open
                        %td
                          %span
                            %a.btn.btn-default.btn-xs{href: 'javascript:void(0);', :onclick => 'loan('+cc.id.to_s+');'}
                              %i.fa.fa-folder-open
                          %span
                            %a.btn.btn-default.btn-xs{href: 'javascript:void(0);', :onclick => 'bond_letter('+cc.id.to_s+');'}
                              Cartas Fianza                              
                        %td
                          %span
                            %a.btn.btn-default.btn-xs{href: 'javascript:void(0);', :onclick => 'load_operating_result('+cc.id.to_s+');'}
                              %i.fa.fa-usd

                  - else
                    = ""
            #c4.tab-pane.fade
              %table.table.table-striped.table-hover.table-condensed
                %thead
                  %tr
                    %th N° de C.C.
                    %th Compañia
                    %th Centro de Costo
                    %th G.D.G.
                    %th 
                      Movimientos
                      %span
                        %a.btn.btn-default.btn-xs{:href => "#{report_pdf_general_expenses_loans_path}.pdf", :target => "_blank"}
                          %i.fa.fa-book
                      %span
                        %a.btn.btn-default.btn-xs{:href => "#{bidimensional_report_pdf_general_expenses_loans_path}.pdf", :target => "_blank"}
                          2D                          
                    %th{"style"=>"width:30px;"} Resultados Operativos
                %tbody
                  -if @administracion!=nil
                    - @administracion.each do |cc|
                      %tr
                        %td= cc.code.to_s
                        %td= cc.company.short_name.to_s
                        %td
                          %a{href: 'javascript:void(0);', :onclick => 'goCoordinatesGMap(' + cc.latitude.to_s + ', ' + cc.longitude.to_s + ');', title: "Geolocalizacion"}
                            %i.fa.fa-adn
                          %a{"style"=>"display:inline;margin-right:5px;",href: 'javascript:void(0);', :onclick => 'detail('+cc.id.to_s+');', title: "Datos generales del centro de costo"}
                            %i.fa.fa-info-circle
                          %div{"style"=>"display:inline;margin-right:5px;"}= cc.name.to_s
                        %td
                          %span
                            %a.btn.btn-default.btn-xs{href: 'javascript:void(0);', :onclick => 'gdg('+cc.id.to_s+');'}
                              %i.fa.fa-folder-open
                        %td
                          %span
                            %a.btn.btn-default.btn-xs{href: 'javascript:void(0);', :onclick => 'loan('+cc.id.to_s+');'}
                              %i.fa.fa-folder-open
                          %span
                            %a.btn.btn-default.btn-xs{href: 'javascript:void(0);', :onclick => 'bond_letter('+cc.id.to_s+');'}
                              Cartas Fianza                                
                        %td
                          %span
                            %a.btn.btn-default.btn-xs{href: 'javascript:void(0);', :onclick => 'load_operating_result('+cc.id.to_s+');'}
                              %i.fa.fa-usd

                  - else
                    = ""
            / end s3 tab pane
          / end content        
  /end cost center row
  / row
  .row
    %article.col-sm-12
      / new widget
      #wid-id-0.jarviswidget{"data-widget-colorbutton" => "false", "data-widget-deletebutton" => "false", "data-widget-editbutton" => "false", "data-widget-fullscreenbutton" => "false", "data-widget-togglebutton" => "false"}
        %header
          %span.widget-icon
            %i.glyphicon.glyphicon-stats.txt-color-darken
          %h2 Ratios de Obra
          %ul#myTab.nav.nav-tabs.pull-right.in
            %li.active
              %a{"data-toggle" => "tab", href: "#s1"}
                %i.fa.fa-clock-o
                %span.hidden-mobile.hidden-tablet Avance Físico
            %li
              %a{"data-toggle" => "tab", href: "#s2"}
                %i.fa.fa-wrench
                %span.hidden-mobile.hidden-tablet N° de Trabajadores
            %li
              %a{"data-toggle" => "tab", href: "#s3"}
                %i.fa.fa-dollar
                %span.hidden-mobile.hidden-tablet Pago a Proveedores
        / widget div
        .no-padding
          / widget edit box
          .jarviswidget-editbox
            test
          / end widget edit box
          .widget-body
            / content
            #myTabContent.tab-content
              #s1.tab-pane.fade.active.in.padding-10.no-padding-bottom
                .row.no-space
                  .col-xs-12.col-sm-12.col-md-8.col-lg-8
                    %span.demo-liveupdate-1
                      %span.onoffswitch-title Ver en Tiempo Real
                      %span.onoffswitch
                        %input#start_interval.onoffswitch-checkbox{name: "start_interval", type: "checkbox"}/
                        %label.onoffswitch-label{for: "start_interval"}
                          %span.onoffswitch-inner{"data-swchoff-text" => "OFF", "data-swchon-text" => "ON"}
                          %span.onoffswitch-switch
                    #updating-chart.chart-large.txt-color-blue
                  .col-xs-12.col-sm-12.col-md-4.col-lg-4.show-stats
                    .row
                      .col-xs-6.col-sm-6.col-md-12.col-lg-12
                        %span.text
                          Avance Físico
                          %span.pull-right= @ratio_avanze_fisico
                        .progress
                          .progress-bar.bg-color-blueDark{style: "width: #{@ratio_avanze_fisico};"}
                      .col-xs-6.col-sm-6.col-md-12.col-lg-12
                        %span.text
                          Ratio de Tiempo
                          %span.pull-right= @ratio_de_tiempo + ' (' + @ratio_de_tiempo_fraccion + ')'
                        .progress
                          .progress-bar.bg-color-blue{style: "width: #{@ratio_de_tiempo};"}
                      .col-xs-6.col-sm-6.col-md-12.col-lg-12
                        %span.text
                          Pago a Proveedores
                          %span.pull-right 77%
                        .progress
                          .progress-bar.bg-color-blue{style: "width: 77%;"}
                      .col-xs-6.col-sm-6.col-md-12.col-lg-12
                        %span.text
                          Cantidad de Trabajadores
                          %span.pull-right= @cant_trabajadores
                        .progress
                          .progress-bar.bg-color-greenLight{style: "width: 54%;"}
                      %span.show-stat-buttons
                        %span.col-xs-12.col-sm-6.col-md-6.col-lg-6
                          %a.btn.btn-default.btn-block.hidden-xs{href: "javascript:void(0);"} Generate PDF
                        %span.col-xs-12.col-sm-6.col-md-6.col-lg-6
                          %a.btn.btn-default.btn-block.hidden-xs{href: "javascript:void(0);"} Report a bug
                .show-stat-microcharts
                  .col-xs-12.col-sm-3.col-md-3.col-lg-3
                    .easy-pie-chart.txt-color-orangeDark{"data-percent" => "33", "data-pie-size" => "50"}
                      %span.percent= @ratio_avanze_fisico
                    %span.easy-pie-title
                      Avance Físico
                      %i.fa.fa-caret-up.icon-color-bad
                    %ul.smaller-stat.hidden-sm.pull-right
                      %li
                        %span.label.bg-color-greenLight
                          %i.fa.fa-caret-up
                          97%
                      %li
                        %span.label.bg-color-blueLight
                          %i.fa.fa-caret-down
                          44%
                    .sparkline.txt-color-greenLight.hidden-sm.hidden-md.pull-right{"data-fill-color" => "transparent", "data-sparkline-height" => "33px", "data-sparkline-type" => "line", "data-sparkline-width" => "70px"}
                      130, 187, 250, 257, 200, 210, 300, 270, 363, 247, 270, 363, 247
                  .col-xs-12.col-sm-3.col-md-3.col-lg-3
                    .easy-pie-chart.txt-color-greenLight{"data-percent" => "78.9", "data-pie-size" => "50"}
                      %span.percent= @ratio_de_tiempo
                    %span.easy-pie-title
                      Ratio de Tiempo
                      %i.fa.fa-caret-down.icon-color-good
                    %ul.smaller-stat.hidden-sm.pull-right
                      %li
                        %span.label.bg-color-blueDark
                          %i.fa.fa-caret-up
                          76%
                      %li
                        %span.label.bg-color-blue
                          %i.fa.fa-caret-down
                          20%
                    .sparkline.txt-color-blue.hidden-sm.hidden-md.pull-right{"data-fill-color" => "transparent", "data-sparkline-height" => "33px", "data-sparkline-type" => "line", "data-sparkline-width" => "70px"}
                      257, 200, 210, 300, 270, 363, 130, 187, 250, 247, 270, 363, 247
                  .col-xs-12.col-sm-3.col-md-3.col-lg-3
                    .easy-pie-chart.txt-color-blue{"data-percent" => "23", "data-pie-size" => "50"}
                      %span.percent.percent-sign 77
                    %span.easy-pie-title
                      Pago a Proveedores
                      %i.fa.fa-caret-up.icon-color-good
                    %ul.smaller-stat.hidden-sm.pull-right
                      %li
                        %span.label.bg-color-darken 80%
                      %li
                        %span.label.bg-color-blueDark
                          %i.fa.fa-caret-up
                          10%
                    .sparkline.txt-color-darken.hidden-sm.hidden-md.pull-right{"data-fill-color" => "transparent", "data-sparkline-height" => "33px", "data-sparkline-type" => "line", "data-sparkline-width" => "70px"}
                      200, 210, 363, 247, 300, 270, 130, 187, 250, 257, 363, 247, 270
                  .col-xs-12.col-sm-3.col-md-3.col-lg-3
                    .easy-pie-chart.txt-color-darken{"data-percent" => "36", "data-pie-size" => "50"}
                      %span.percent
                        = @cant_trabajadores
                        %i.fa.fa-caret-up
                    %span.easy-pie-title
                      Cantidad de Trabajadores
                      %i.fa.fa-caret-down.icon-color-good
                    %ul.smaller-stat.hidden-sm.pull-right
                      %li
                        %span.label.bg-color-red
                          %i.fa.fa-caret-up
                          60
                      %li
                        %span.label.bg-color-blue
                          %i.fa.fa-caret-down
                          20
                    .sparkline.txt-color-red.hidden-sm.hidden-md.pull-right{"data-fill-color" => "transparent", "data-sparkline-height" => "33px", "data-sparkline-type" => "line", "data-sparkline-width" => "70px"}
                      2700, 3631, 2471, 2700, 3631, 2471, 1300, 1877, 2500, 2577, 2000, 2100, 3000
              / end s1 tab pane
              #s2.tab-pane.fade
                .widget-body-toolbar.bg-color-white
                  %form.form-inline{role: "form"}
                    .form-group
                      %label.sr-only{for: "s123"} Show From
                      %input#s123.form-control.input-sm{placeholder: "Show From", type: "email"}/
                    .form-group
                      %input#s124.form-control.input-sm{placeholder: "To", type: "email"}/
                    .btn-group.hidden-phone.pull-right
                      %a.btn.dropdown-toggle.btn-xs.btn-default{"data-toggle" => "dropdown"}
                        %i.fa.fa-cog
                        More
                        %span.caret
                      %ul.dropdown-menu.pull-right
                        %li
                          %a{href: "javascript:void(0);"}
                            %i.fa.fa-file-text-alt
                            Export to PDF
                        %li
                          %a{href: "javascript:void(0);"}
                            %i.fa.fa-question-sign
                            Help
                .padding-10
                  #statsChart.chart-large.has-legend-unique
              / end s2 tab pane
              #s3.tab-pane.fade
                #rev-toggles.widget-body-toolbar.bg-color-white.smart-form
                  .inline-group
                    %label.checkbox{for: "gra-0"}
                      %input#gra-0{checked: "checked", name: "gra-0", type: "checkbox"}/
                      %i
                      Target
                    %label.checkbox{for: "gra-1"}
                      %input#gra-1{checked: "checked", name: "gra-1", type: "checkbox"}/
                      %i
                      Actual
                    %label.checkbox{for: "gra-2"}
                      %input#gra-2{checked: "checked", name: "gra-2", type: "checkbox"}/
                      %i
                      Signups
                  .btn-group.hidden-phone.pull-right
                    %a.btn.dropdown-toggle.btn-xs.btn-default{"data-toggle" => "dropdown"}
                      %i.fa.fa-cog
                      More
                      %span.caret
                    %ul.dropdown-menu.pull-right
                      %li
                        %a{href: "javascript:void(0);"}
                          %i.fa.fa-file-text-alt
                          Export to PDF
                      %li
                        %a{href: "javascript:void(0);"}
                          %i.fa.fa-question-sign
                          Help
                .padding-10
                  #flotcontainer.chart-large.has-legend-unique
              / end s3 tab pane
            / end content
        / end widget div
      / end widget
  / end row

  / row
  .row
    / NEW WIDGET START
    %article.col-xs-12.col-sm-12.col-md-12.col-lg-12
      / Widget ID (each widget will need unique ID)
      #wid-id-2.jarviswidget.jarviswidget-color-greenDark{"data-widget-colorbutton" => "false", "data-widget-deletebutton" => "false", "data-widget-editbutton" => "false", "data-widget-fullscreenbutton" => "false", "data-widget-togglebutton" => "false"}

        %header
          %span.widget-icon
            %i.fa.fa-map-marker
          %h2 Mapa
        / widget div
        %div
          / widget edit box
          .jarviswidget-editbox
            / This area used as dropdown edit box
          .widget-body.no-padding
            #map_canvas2.google_maps{:style => 'height: 500px;'}


            / end content
        / end widget div
      / end widget






:javascript
  // DO NOT REMOVE : GLOBAL FUNCTIONS!
  pageSetUp();
  
  /*
   * PAGE RELATED SCRIPTS
   */
  
  $(".js-status-update a").click(function () {
      var selText = $(this).text();
      $this = $(this);
      $this.parents('.btn-group').find('.dropdown-toggle').html(selText + ' <span class="caret"></span>');
      $this.parents('.dropdown-menu').find('li').removeClass('active');
      $this.parent().addClass('active');
  });

  var colorful_style = [{
      "featureType": "landscape",
      "stylers": [{
          "visibility": "off"
        }]
    }];
    
  // One color - Change the hue value for your desired color
  var mono_color_style = [{
      "stylers": [{
          "hue": "#ff00aa"
      }, {
          "saturation": 1
      }, {
          "lightness": 1
      }]
  }];
  
  /*
   * RUN PAGE GRAPHS
   */
  
  // Load FLOAT dependencies (related to page)
  loadScript("#{ asset_path 'plugin/flot/jquery.flot.cust.js', type: :javascript }", loadFlotResize);

  $(window).bind('gMapsLoaded', initialize);
  window.loadGoogleMaps();
  
  function loadFlotResize() {
    loadScript("#{ asset_path 'plugin/flot/jquery.flot.resize.js', type: :javascript }", loadFlotToolTip);
  }
  
  function loadFlotToolTip() {
    loadScript("#{ asset_path 'plugin/flot/jquery.flot.tooltip.js', type: :javascript }", generatePageGraphs);
  }
  
  function generatePageGraphs() {
  
      /* TAB 1: UPDATING CHART */
      // For the demo we use generated data, but normally it would be coming from the server
  
      var data = [],
          totalPoints = 200,
          $UpdatingChartColors = $("#updating-chart").css('color');
  
      function getRandomData() {
          if (data.length > 0)
              data = data.slice(1);
  
          // do a random walk
          while (data.length < totalPoints) {
              var prev = data.length > 0 ? data[data.length - 1] : 50;
              var y = prev + Math.random() * 10 - 5;
              if (y < 0)
                  y = 0;
              if (y > 100)
                  y = 100;
              data.push(y);
          }
  
          // zip the generated y values with the x values
          var res = [];
          for (var i = 0; i < data.length; ++i)
              res.push([i, data[i]])
          return res;
      }
  
      // setup control widget
      var updateInterval = 1500;
      $("#updating-chart").val(updateInterval).change(function () {
  
          var v = $(this).val();
          if (v && !isNaN(+v)) {
              updateInterval = +v;
              $(this).val("" + updateInterval);
          }
  
      });
  
      // setup plot
      var options = {
          yaxis: {
              min: 0,
              max: 100
          },
          xaxis: {
              min: 0,
              max: 100
          },
          colors: [$UpdatingChartColors],
          series: {
              lines: {
                  lineWidth: 1,
                  fill: true,
                  fillColor: {
                      colors: [{
                          opacity: 0.4
                      }, {
                          opacity: 0
                      }]
                  },
                  steps: false
  
              }
          }
      };
  
      var plot = $.plot($("#updating-chart"), [getRandomData()], options);
  
      /* live switch */
      $('input[type="checkbox"]#start_interval').click(function () {
          if ($(this).prop('checked')) {
              $on = true;
              updateInterval = 1500;
              update();
          } else {
              clearInterval(updateInterval);
              $on = false;
          }
      });
  
      function update() {
          if ($on == true) {
              plot.setData([getRandomData()]);
              plot.draw();
              setTimeout(update, updateInterval);
  
          } else {
              clearInterval(updateInterval)
          }
  
      }
  
      var $on = false;
  
      /*end updating chart*/
  
      /* TAB 2: Social Network  */
  
      $(function () {
          // jQuery Flot Chart
          workers = #{@axis_y},
          data = [{
              label: "N° de Trabajadores",
              data: workers,
              lines: {
                show: true,
                lineWidth: 1,
                fill: true,
                fillColor: {
                  colors: [{
                    opacity: 0.1
                  }, {
                    opacity: 0.13
                  }]
                }
              },
              points: {
                show: true
              }
          }];
  
          var options = {
              grid: {
                hoverable: true
              },
              colors: ["#568A89"],
              tooltip: true,
              tooltipOpts: {
                defaultTheme: false
              },
              xaxis: {
                ticks: #{@axis_x}
              },
              yaxes: {
                tickFormatter: function (val, axis) {
                  return val;
                }
              }
          };
  
          var plot3 = $.plot($("#statsChart"), data, options);
      });
  
      // END TAB 2
  
      // TAB THREE GRAPH //
      /* TAB 3: Revenew  */
  
      $(function () {
  
          var trgt = [
              [1354586000000, 153],
              [1364587000000, 658],
              [1374588000000, 198],
              [1384589000000, 663],
              [1394590000000, 801],
              [1404591000000, 1080],
              [1414592000000, 353],
              [1424593000000, 749],
              [1434594000000, 523],
              [1444595000000, 258],
              [1454596000000, 688],
              [1464597000000, 364]
          ],
              prft = [
                  [1354586000000, 53],
                  [1364587000000, 65],
                  [1374588000000, 98],
                  [1384589000000, 83],
                  [1394590000000, 980],
                  [1404591000000, 808],
                  [1414592000000, 720],
                  [1424593000000, 674],
                  [1434594000000, 23],
                  [1444595000000, 79],
                  [1454596000000, 88],
                  [1464597000000, 36]
              ],
              sgnups = [
                  [1354586000000, 647],
                  [1364587000000, 435],
                  [1374588000000, 784],
                  [1384589000000, 346],
                  [1394590000000, 487],
                  [1404591000000, 463],
                  [1414592000000, 479],
                  [1424593000000, 236],
                  [1434594000000, 843],
                  [1444595000000, 657],
                  [1454596000000, 241],
                  [1464597000000, 341]
              ],
              toggles = $("#rev-toggles"),
              target = $("#flotcontainer");
  
          var data = [{
              label: "Target Profit",
              data: trgt,
              bars: {
                  show: true,
                  align: "center",
                  barWidth: 30 * 30 * 60 * 1000 * 80
              }
          }, {
              label: "Actual Profit",
              data: prft,
              color: '#3276B1',
              lines: {
                  show: true,
                  lineWidth: 3
              },
              points: {
                  show: true
              }
          }, {
              label: "Actual Signups",
              data: sgnups,
              color: '#71843F',
              lines: {
                  show: true,
                  lineWidth: 1
              },
              points: {
                  show: true
              }
          }]
  
          var options = {
              grid: {
                  hoverable: true
              },
              tooltip: true,
              tooltipOpts: {
                  //content: '%x - %y',
                  //dateFormat: '%b %y',
                  defaultTheme: false
              },
              xaxis: {
                  mode: "time"
              },
              yaxes: {
                  tickFormatter: function (val, axis) {
                      return "$" + val;
                  },
                  max: 1200
              }
  
          };
  
          plot2 = null;
  
          function plotNow() {
              var d = [];
              toggles.find(':checkbox').each(function () {
                  if ($(this).is(':checked')) {
                      d.push(data[$(this).attr("name").substr(4, 1)]);
                  }
              });
              if (d.length > 0) {
                  if (plot2) {
                      plot2.setData(d);
                      plot2.draw();
                  } else {
                      plot2 = $.plot(target, d, options);
                  }
              }
  
          };
  
          toggles.find(':checkbox').on('change', function () {
              plotNow();
          });
          plotNow()
  
      });
  
  }
  
  /*
   * VECTOR MAP
   */
  
  data_array = {
      "C.C Arequipa - Aplao": 7230,
      "C.C Saldos Rioja": 7232,
      "C.C Bagua": 7232,
      "C.C Huaraz": 7232,
      "C.C Huancavelica": 7232,
      "C.C Huancayo": 7232
  };
  
  // Load Map dependency 1 then call for dependency 2
  loadScript("#{ asset_path 'plugin/vectormap/jquery-jvectormap-1.2.2.min.js', type: :javascript }", loadMapFile);
  
  // Load Map dependency 2 then rendeder Map
  function loadMapFile() {
    loadScript("#{ asset_path 'plugin/vectormap/jquery-jvectormap-world-mill-en.js', type: :javascript }", renderVectorMap);
  }
  
  function renderVectorMap() {
      $('#vector-map').vectorMap({
          map: 'world_mill_en',
          backgroundColor: '#fff',
          regionStyle: {
              initial: {
                  fill: '#c4c4c4'
              },
              hover: {
                  "fill-opacity": 1
              }
          },
          series: {
              regions: [{
                  values: data_array,
                  scale: ['#85a8b6', '#4d7686'],
                  normalizeFunction: 'polynomial'
              }]
          },
          onRegionLabelShow: function (e, el, code) {
              if (typeof data_array[code] == 'undefined') {
                  e.preventDefault();
              } else {
                  var countrylbl = data_array[code];
                  el.html(el.html() + ': ' + countrylbl + ' visits');
              }
          }
      });
  }

  function initialize() {
    
    var marker;
    var markers = new Array();

    var mapOptions = {
      center: new google.maps.LatLng(-9.1951786, -74.9904165),
      zoom: 12
    };

    var colorfulStyleMap = new google.maps.StyledMapType(colorful_style, {
      name: "Colorful"
    });
    
    map = new google.maps.Map(document.getElementById('map_canvas2'), mapOptions);
    
    var infowindow = new google.maps.InfoWindow({
      maxWidth: 160
    });

    // Setup skin for the map
    map.mapTypes.set('colorful_style', colorfulStyleMap);
    map.setMapTypeId('colorful_style');

    var locations = [
      ['<h4>Aplao - Arequipa</h4>', -16.076675, -72.492133],
      ['<h4>Bagua - Amazonas, Perú</h4>', -5.634739, -78.532501],
      ['<h4>Saposoa - Perú</h4>', -6.9349658, -76.7728913],
      ['<h4>Rioja Paquete 1</h4>', -6.0526172, -77.1599013],
      ['<h4>Rioja Paquete 3</h4>', -6.0594871, -77.1636401],
      ['<h4>Rioja</h4>', -6.0569995, -77.1685508]
    ];

    for (var i = 0; i < locations.length; i++) {  
      marker = new google.maps.Marker({
        position: new google.maps.LatLng(locations[i][1], locations[i][2]),
        map: map
      });

      markers.push(marker);

      google.maps.event.addListener(marker, 'click', (function(marker, i) {
        return function() {
          infowindow.setContent(locations[i][0]);
          infowindow.open(map, marker);
        }
      })(marker, i));
    }
  }

  function gdg(id) {
    data = { authenticity_token: "#{form_authenticity_token}", cc_id: id};
    load_url_ajax('#{general_expenses_diverse_expenses_of_managements_path}', 'gdg', data, null, 'GET');
    $('#gdg').modal({
      keyboard: false,
      backdrop: 'static'
    });
  }

  function detail(id) {
    data = { authenticity_token: "#{form_authenticity_token}", cc_id: id }
    load_modal_ajax('/logistics/cost_center_details/' + id, 'detail', 'previous', data, null, 'GET')
  }

  function gdg_new(id){
    data = { authenticity_token: "#{form_authenticity_token}", cc_id: id};
    load_modal_ajax('#{new_general_expenses_diverse_expenses_of_management_path}', 'gdgn', 'gdg', data, null, 'GET');
  }

  function gdg_edit(id){
    data = { authenticity_token: "#{form_authenticity_token}"};
    load_modal_ajax('/general_expenses/diverse_expenses_of_managements/'+id+'/edit', 'gdge', 'gdg', data, null, 'GET');
  }

  function gdg_show(id){
    data = { authenticity_token: "#{form_authenticity_token}"};
    load_modal_ajax('/general_expenses/diverse_expenses_of_managements/'+id+'', 'gdgs', 'gdg', data, null, 'GET');
  }  

  function loan(id){
    data = { authenticity_token: "#{form_authenticity_token}", cc_id: id};
      load_url_ajax('#{general_expenses_loans_path}', 'loan', data, null, 'GET');
    $('#loan').modal({
      keyboard: false,
      backdrop: 'static'
    });
  }

  function loan_new(id){
    data = { authenticity_token: "#{form_authenticity_token}", cc_id: id};
    load_modal_ajax('#{new_general_expenses_loan_path}', 'loan_new', 'loan', data, null, 'GET');
  }

  function loan_edit(id,cc1,cc2,cc3){
    data = { authenticity_token: "#{form_authenticity_token}", cc1:cc1, cc2:cc2, cc3:cc3};
    load_modal_ajax('/general_expenses/loans/'+id+'/edit', 'loan_edit', 'loan_show', data, null, 'GET');
  }

  function loan_show(cc1,cc2,cc3){
    data = { authenticity_token: "#{form_authenticity_token}", cc1:cc1, cc2:cc2, cc3:cc3};
    load_modal_ajax('#{general_expenses_loan_path("show")}', 'loan_show', 'loan', data, null, 'GET');
  }   

  function bond_letter(cc_id){
    data = { authenticity_token: "#{form_authenticity_token}", cc: cc_id};
    load_url_ajax('#{general_expenses_bond_letters_path}', 'bond_letter_index', data, null, 'GET');
    $('#bond_letter_index').modal({
      keyboard: false,
      backdrop: 'static'
    });
  }

  function bond_letter_new(cc_id){
    data = { authenticity_token: "#{form_authenticity_token}", cc: cc_id};
    load_modal_ajax('#{new_general_expenses_bond_letter_path}', 'bond_letter_new', 'bond_letter_index', data, null, 'GET');
  }

  function bond_letter_edit(cc_id,bl_id){
    data = { authenticity_token: "#{form_authenticity_token}", cc: cc_id};
    load_modal_ajax('/general_expenses/bond_letters/'+bl_id+'/edit', 'bond_letter_edit', 'bond_letter_index', data, null, 'GET');
  }

  function bond_letter_detail_new(cc_id, bl_id){
    data = { authenticity_token: "#{form_authenticity_token}", cc: cc_id, bl: bl_id};
    load_modal_ajax('#{new_bond_letter_detail_general_expenses_bond_letters_path}', 'bond_letter_detail_new', 'bond_letter_index', data, null, 'GET');
  }

  function bond_letter_detail_edit(cc_id,bl_id){
    data = { authenticity_token: "#{form_authenticity_token}", cc: cc_id};
    load_modal_ajax('/general_expenses/bond_letters/'+bl_id+'/edit_bond_letter_detail', 'bond_letter_detail_edit', 'bond_letter_index', data, null, 'GET');
  }    

  function load_operating_result(cost_center_id){
    data = { authenticity_token : "#{form_authenticity_token}", cost_center : cost_center_id }
    load_url_ajax('#{projecting_operating_results_path}', 'operating-result', data, 'avoid-opacity', 'POST');
    $('#operating-result').modal({
      keyboard: false,
      backdrop: 'static'
    });
  }

  function load_full_operating_result(cost_center_id){
    $("#itemsModal").modal({
      keyboard: false,
      backdrop: false
    });

    load_url_ondiv("#{full_project_operating_results_path}?authenticity_token=#{form_authenticity_token}&cost_center=" + cost_center_id, "detail-inputs");
  }

  function get_input_detail(d_sale, b_goal, b_cat){
    $("#itemsModal").modal();
    load_url_ondiv("#{get_input_detail_administration_inputcategories_path}?category_id=0" + b_cat + "&budget_sale_id=" + d_sale + "&budget_goal_id=" + b_goal, "detail-inputs");
  }

  function show_phases(cost_center_id, code_phase){
    data = { authenticity_token : "#{form_authenticity_token}", cost_center_id : cost_center_id, code_phase : code_phase }
    load_url_ajax('#{show_phases_path}', 'show-phase', data, 'avoid-opacity', 'POST');
    $('#show-phase').modal({
      keyboard: false,
      backdrop: false
    });
  }

  function goCoordinatesGMap(latitud, longitud){
    if(latitud != '' && longitud != ''){
      gMap = new google.maps.Map(document.getElementById('map_canvas2')); 
      gMap.setZoom(16);
      gMap.setCenter(new google.maps.LatLng(latitud, longitud));
      gMap.setMapTypeId(google.maps.MapTypeId.ROADMAP);

      var marker;
      var markers = new Array();

      var locations = [
        ['<h4>Aplao - Arequipa</h4>', -16.076675, -72.492133],
        ['<h4>Bagua - Amazonas, Perú</h4>', -5.634739, -78.532501],
        ['<h4>Saposoa - Perú</h4>', -6.9349658, -76.7728913],
        ['<h4>Rioja Paquete 1</h4>', -6.0526172, -77.1599013],
        ['<h4>Rioja Paquete 3</h4>', -6.0594871, -77.1636401],
        ['<h4>Rioja</h4>', -6.0569995, -77.1685508]
      ];

      var infowindow = new google.maps.InfoWindow({
        maxWidth: 160
      });

      for (var i = 0; i < locations.length; i++) {  
        marker = new google.maps.Marker({
          position: new google.maps.LatLng(locations[i][1], locations[i][2]),
          map: gMap
        });

        markers.push(marker);

        google.maps.event.addListener(marker, 'click', (function(marker, i) {
          return function() {
            infowindow.setContent(locations[i][0]);
            infowindow.open(gMap, marker);
          }
        })(marker, i));
      }

      window.scrollTo(0,document.body.scrollHeight);

    } else {
      alert('Faltan datos para mostrar la ubicación de esta obra.')
    }
  }

  function show_phases(cost_center_id, code_phase){
    data = { authenticity_token : "#{form_authenticity_token}", cost_center_id : cost_center_id, code_phase : code_phase }
    load_url_ajax('#{show_phases_path}', 'show-phase', data, 'avoid-opacity', 'POST');
    $('#show-phase').modal({
      keyboard: false,
      backdrop: false
    });
  }