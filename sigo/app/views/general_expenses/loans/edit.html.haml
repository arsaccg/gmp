.modal-dialog{"style"=>"width: 50%"}
  .modal-content
    .modal-header
      %header
        %h2
          %span.widget-icon
            %i.fa.fa-pencil-square-o.fa-fw 
          %strong Editar Préstamo
    .modal-body
      = form_for @loan, url: general_expenses_loan_path(@loan.id), as: :patch, html: { class: "smart-form", id: "upload_deregister" } do |f|
        %fieldset
          %input#cc{ :value => "#{@loan.cost_center_lender_id.to_i.to_s}", "style"=>"display:none"}
          %input#loan{ :value => "#{@loan.id.to_i.to_s}", "style"=>"display:none"}
          .row{"style"=>"margin-bottom:3%;"}
            .col-md-5
              %label Beneficiario
            .col-md-5
              %select#beneficiary.form-control{:name =>"loan[cost_center_beneficiary_id]"}
                %option{:value => nil, :selected => true, :disabled => true} Seleccione un Beneficiario
                - @costcenters.each do |ph|
                  %option{:value => "#{ph.id}", :selected => "#{@loan.cost_center_beneficiary_id}"=="#{ph.id}"}
                    = ph.name
          .row{"style"=>"margin-bottom:3%;"}
            .col-md-5
              %label Entregado a
            .col-md-5
              .input-group.col-md-11
                -e=Entity.find(Worker.find(@loan.person).entity_id)
                %i.icon-append.fa.fa-superscript
                = text_field_tag 'loan[person]', "#{e.name}"+" "+"#{e.paternal_surname}"+" "+"#{e.maternal_surname}", class: "form-control quantity", :required => true,:readonly=>true,as: :float
          .row{"style"=>"margin-bottom:3%;"}
            .col-md-5
              %label Fecha
            .col-md-5
              = text_field_tag 'loan[loan_date]', "#{@loan.loan_date}" , class: "form-control quantity", :required => true,as: :string,:type=>"date"
          .row{"style"=>"margin-bottom:3%;"}
            .col-md-5
              %label Forma de Préstamo
            .col-md-5
              %select#loan_type.form-control{:name =>"loan[loan_type]"}
                %option{:value => nil, :disabled => true} Seleccione una Forma
                %option{:value => "1",:selected => "#{@loan.loan_type}"=="1"} Cheque
                %option{:value => "2",:selected => "#{@loan.loan_type}"=="2"} Transferencia
                %option{:value => "3",:selected => "#{@loan.loan_type}"=="3"} Efectivo
          .row{"style"=>"margin-bottom:3%;"}
            .col-md-5
              %label Monto
            .col-md-5
              .input-group.col-md-11
                %i.icon-append.fa.fa-superscript
                = text_field_tag 'loan[amount]', "#{@loan.amount}", class: "form-control quantity", :required => true, :readonly =>true
          .row{"style"=>"margin-bottom:3%;"}
            .col-md-5
              %label Motivo
            .col-md-5
              .input-group.col-md-11
                %i.icon-append.fa.fa-superscript
                = text_area_tag 'loan[description]', "#{@loan.description}", class: "form-control quantity", :required => true
          .row{"style"=>"margin-bottom:3%;"}
            .col-md-5
              %label Forma de Devolución
            .col-md-5
              %select#refund_type.form-control{:name =>"loan[refund_type]"}
                %option{:value => nil, :disabled => true} Seleccione una Forma
                %option{:value => "1",:selected => "#{@loan.refund_type}"=="1"} Cheque
                %option{:value => "2",:selected => "#{@loan.refund_type}"=="2"} Transferencia
                %option{:value => "3",:selected => "#{@loan.refund_type}"=="3"} Efectivo
          .row#checkn{"style"=>"margin-bottom:3%;display:none;"}
            .col-md-5
              %label N° Cheque
            .col-md-5
              .input-group.col-md-11
                %i.icon-append.fa.fa-superscript
                = text_field_tag 'loan[check_number]',"#{@loan.loan_date}", class: "form-control quantity",as: :float
          .row#checkd{"style"=>"margin-bottom:3%;display:none;"}
            .col-md-5
              %label Fecha de Cheque
            .col-md-5
              = text_field_tag 'loan[check_date]', "#{@loan.check_date}" , class: "form-control quantity",as: :string,:type=>"date"
          .row{"style"=>"margin-bottom:3%;"}
            .col-md-5
              %label Estado
            .col-md-5
              %select#state.select2.form-control{:name =>"loan[state]"}
                %option{:value => nil, :disabled => true} Seleccione un Estado
                %option{:value => "1",:selected => "#{@loan.state}"=="1"} Pendiente
                %option{:value => "2",:selected => "#{@loan.state}"=="2"} Devuelto
          .row#devdate{"style"=>"margin-bottom:3%;display:none;"}
            .col-md-5
              %label Fecha de Devolución
            .col-md-5
              = text_field_tag 'loan[check_date]', "#{@loan.check_date}" , class: "form-control quantity",as: :string,:type=>"date"
        %br
        %br
        %footer
          %button.btn.btn-primary#details{type: "button", "style"=>"float:right;"}
            %i.fa.fa-save
              Guardar
          %button.btn.btn-info#edit{"data-dismiss" => "modal", type: "button"}
            Salir  

  :javascript
    $(document).ready(function () {
      $('select').select2({width:'100%'});
      submit_form($('form#upload_deregister'))


      $("#refund_type").change(function() {
          // foo is the id of the other select box 
          if ($(this).val() == "1") {
              $("#checkn").show();
              $("#checkd").show();
          }else{
              $("#checkn").hide();
              $("#checkd").hide();
          } 
      });
      $("#state").change(function() {
          // foo is the id of the other select box 
          if ($(this).val() == "2") {
              $("#devdate").show();
          }else{
              $("#devdate").hide();
          } 
      });
    });

    function submit_form(form_element){
      form_element.ajaxForm({
        beforeSubmit: function() {
          form_element.validate({
            // Rules for form validation
            rules : {
              'loan[amount]' : {
                number : true,
              }
            },

            // Messages for form validation
            messages : {

              'loan[amount]' : {
                number : "Debe ingresar un numero válido.",
              }
  
            },

            // Do not change code below
            errorPlacement : function(error, element) {
              error.insertAfter(element.parent());
            }
          });
          // Remove all Help-inLine
          $(".help-inline").remove();
          // Client Valid
          return form_element.valid();
        },
        success: function (data){
          $(".help-inline").parent().addClass("state-error");
        },
        error: function(xhr, status, error) {
          console.log(error);
        }
      })
    }

    $("#details").click(function(e) {
      $('form#upload_deregister').submit();

      data2 = { authenticity_token: "#{form_authenticity_token}", cc_id: $('#cc').val()};
      load_modal_ajax('#{general_expenses_loans_path}', 'loan', 'loan_edit', data2, null, 'GET');
      $.smallBox({
        title : "Exito",
        content : "<i class='fa fa-clock-o'></i> <i>Se actualizó el gasto de gestion</i>",
        color : "#659265",
        iconSmall : "fa fa-check fa-2x fadeInRight animated",
        timeout : 4000
      });
    });

    $("#edit").click(function() {
      data2 = { authenticity_token: "#{form_authenticity_token}", cc_id: $('#cc').val()};
      load_modal_ajax('#{general_expenses_loans_path}', 'loan', 'loan_edit', data2, null, 'GET');
    });

    function isNumber(evt) {
      evt = (evt) ? evt : window.event;
      var charCode = (evt.which) ? evt.which : evt.keyCode;
      if (charCode > 31 && (charCode < 48 || charCode > 57) && charCode != 46) {
          return false;
      }
      return true;
    }