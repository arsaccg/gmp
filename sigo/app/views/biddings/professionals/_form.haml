=simple_form_for([:biddings, @professional], html: { multipart: true }) do |f|
  #bootstrap-wizard.col-sm-12
    .form-bootstrapWizard
      %ul.bootstrapWizard.form-wizard
        %li.active{"data-target" => "#step1"}
          %a{"data-toggle" => "tab", href: "#tab1"}
            %span.step 1
            %span.title Información Básica
        %li{"data-target" => "#step2"}
          %a{"data-toggle" => "tab", href: "#tab2"}
            %span.step 2
            %span.title Certificados
        %li{"data-target" => "#step3"}
          %a{"data-toggle" => "tab", href: "#tab3"}
            %span.step 3
            %span.title Capacitaciones
        %li{"data-target" => "#step4"}
          %a{"data-toggle" => "tab", href: "#tab4"}
            %span.step 4
            %span.title Guardar formurlario
      .clearfix
    .tab-content
      #tab1.tab-pane.active
        %br/
        %h3
          %strong Paso 1
          \- Información básica
        .row
          .col-sm-4
            %label Nombre
            .form-group
              .input-group
                %span.input-group-addon
                  %i.fa.fa-user.fa-md.fa-fw
                = f.input :name, placeholder: "Nombre", input_html: { class: 'form-control' }, label: false
          .col-sm-4
            %label DNI:
            .form-group
              .input-group
                %span.input-group-addon
                  %i.fa.fa-superscript.fa-md.fa-fw
                = f.input :dni, placeholder: "DNI", input_html: { class: 'form-control' }, label: false
          .col-sm-4
            %label Profesiones
            .input-group.col-md-12
              = f.association :majors, :as => :collection_select, :label => false, :input_html =>{:class => "select2-choices", :multiple => true}
        .row
          .col-sm-4
            %label Fecha de Titulación
            .form-group
              .input-group
                %span.input-group-addon
                  %i.fa.fa-calendar.fa-md.fa-fw
                = f.input :professional_title_date, as: :string, input_html: { :class => 'form-control', :type => "date" }, label: false

          .col-sm-4
            %label Fecha de Colegiatura
            .form-group
              .input-group
                %span.input-group-addon
                  %i.fa.fa-calendar.fa-md.fa-fw
                = f.input :date_of_tuition, as: :string, input_html: { :class => 'form-control', :type => "date" }, label: false
          .col-sm-4
            %label Número de Colegiatura
            .form-group
              .input-group
                %span.input-group-addon
                  %i.fa.fa-superscript.fa-md.fa-fw
                = f.input :code_tuition, placeholder: "Número de Colegiatura", input_html: { :class => 'form-control' }, label: false
        %fieldset
          %legend Archivos a Adjuntar
          .row
            .col-sm-4
              .col-sm-3
                %label Título profesional
              .col-sm-9
                = f.input :professional_title, :input_html => { class: 'btn btn-default' }, label: false, onchange: "this.parentNode.nextSibling.value = this.value", as: "file"
                %p.help-block
                  - if @action == 'edit' && @professional.professional_title.exists?
                    = 'Archivo subido: ' + File.basename(@professional.professional_title.path, File.extname(@professional.professional_title.path))
                  - else
                    Subir el archivo correspondiente
            .col-sm-2
            .col-sm-4
              .col-sm-3
                %label Colegiatura
              .col-sm-9
                = f.input :tuition, :input_html => { class: 'btn btn-default' }, label: false, onchange: "this.parentNode.nextSibling.value = this.value", as: "file"
                %p.help-block
                  - if @action == 'edit' && @professional.tuition.exists?
                    = 'Archivo subido: ' + File.basename(@professional.tuition.path, File.extname(@professional.tuition.path))
                  - else
                    Subir el archivo correspondiente
          %br
          .row
            .col-sm-4
              .col-sm-3
                %label Curriculum Vitae
              .col-sm-9
                = f.input :cv, :input_html => { class: 'btn btn-default' }, label: false, onchange: "this.parentNode.nextSibling.value = this.value", as: "file"
                %p.help-block
                  - if @action == 'edit' && @professional.cv.exists?
                    = 'Archivo subido: ' + File.basename(@professional.cv.path, File.extname(@professional.cv.path))
                  - else
                    Subir el archivo correspondiente

      #tab2.tab-pane
        %br/
        %h3
          %strong Paso 2
          \- Certificados
        .row
          .col-md-4
            %a.btn.btn-labeled.btn-success{ :href => 'javascript:void(0);', :onclick => 'add_certificates();'}
              %span.btn-label
                %i.fa.fa-plus
              Añadir Certificados
        #wid-id-10.jarviswidget.jarviswidget-color-blueLight{"data-widget-colorbutton" => "false", "data-widget-custombutton" => "false", "data-widget-deletebutton" => "false", "data-widget-editbutton" => "false", "data-widget-fullscreenbutton" => "false", "data-widget-sortable" => "false", "data-widget-togglebutton" => "false"}
          %div
            .widget-body.no-padding
              #accordion-ce.panel-group.smart-accordion-default
                - if @action=="edit"
                  -if @certificates.count != 0
                    -@certificates.each do |cert|
                      .panel.panel-default
                        .panel-heading
                          %h4.panel-title
                            %a{"data-parent" => "#accordion-ce", "data-toggle" => "collapse", href: "#collapse"+@reg.to_s+"-1"}
                              %i.fa.fa-fw.fa-plus-circle.txt-color-green
                              %i.fa.fa-fw.fa-minus-circle.txt-color-red
                              Certificados
                            %div{"style"=>"width: 50px; float: right; color: white; background: #2070a8;  text-align: center;"}
                              = check_box_tag 'professional[certificates_attributes][' + @reg.to_s  + '][_destroy]'
                        .panel-collapse.collapse{ 'id'=> "collapse"+@reg.to_s+"-1"}
                          .panel-body
                            = hidden_field_tag 'professional[certificates_attributes][' + @reg.to_s + '][id]', cert.id
                            = hidden_field_tag 'professional[certificates_attributes][' + @reg.to_s + '][professional_id]', @professional.id
                            .row
                              .col-sm-4
                                %label Nombre de la obra
                                %select.form-control#work-id{'class'=>'work-select', name: "professional[certificates_attributes][" + @reg.to_s + "][work_id]", onchange: 'workSelectCH(this);', onload:'workSelectKU(this);' }
                                  %option Seleccione Una Obra
                                  -@work.each do |wc|
                                    -if wc.id == cert.work_id
                                      %option{value: "#{wc.id}", :selected=>'selected'} 
                                        = "#{wc.name}"
                                    -else
                                      %option{value: "#{wc.id}"} 
                                        = "#{wc.name}"

                              .col-sm-2
                                %label Inicio de la obra: 

                                %label.input{'class'=>'start_certificate'}
                                  %input.form-control{:disabled=>"disabled", as: :date, type:  "date"}
                              .col-sm-2
                                %label Termino de la obra: 

                                %label.input{'class'=>'finish_certificate'}
                                  %input.form-control{:disabled=>"disabled", as: :date, type:  "date"}
                              
                            %br
                            .row{'class'=>'2'}
                              .col-sm-4
                                %label Entidad contratante

                                .input-group{'class'=>'entity'}
                                  %input.form-control{:disabled=>"disabled"}
                                  %span.input-group-addon
                                    %i.fa.fa-gears
                              .col-sm-4
                                %label Contratista
                                
                                .input-group{'class'=>'contractor'}
                                  %input.form-control{:disabled=>"disabled"}
                                  %span.input-group-addon
                                    %i.fa.fa-gears

                              .col-sm-4
                                %label Cargo
                                %select.form-control#charge{name: "professional[certificates_attributes][" + @reg.to_s + "][charge_id]"}
                                  %option Seleccione un cargo
                                  -@charge.each do |wc|
                                    - if wc.id==cert.charge_id
                                      %option{value: "#{wc.id}", :selected=>"selected"} 
                                        = "#{wc.name}"
                                    -else
                                      %option{value: "#{wc.id}"} 
                                        = "#{wc.name}"

                            %br
                            .row{'class'=>'3'} 
                              .col-sm-4
                                %label Cantidad de días trabajados
                                %input.form-control{'class'=>'worked-day', name: "professional[certificates_attributes][" + @reg.to_s + "][num_days]", :readonly=>"true", :value=> "#{cert.num_days}"}
                            
                            %br
                            .row
                              .col-sm-2
                                //%a.btn.btn-primary{href: 'javascript:void(0);', :onclick => 'add_dates(this);'} Agregar más fechas

                            %br
                            .row{'class'=>'fechas'}
                              .col-sm-4
                                %label.col-sm-4 Fecha de Inicio:
                                .col-sm-8
                                  .input-group
                                    %input.form-control{'class'=>'start-worker', name: "professional[certificates_attributes][" + @reg.to_s + "][start_date]", as: :date, type:  "date", :value=>"#{cert.start_date}", onchange:'calculateDays2(this);'}
                                    %span.input-group-addon
                                      %i.fa.fa-calendar
                            
                              .col-sm-4
                                %label.col-sm-4.control-label Fecha de Termino:
                                .col-sm-8
                                  .input-group
                                    %input.form-control{'class'=>'finish-worker', name:"professional[certificates_attributes][" + @reg.to_s + "][finish_date]", as: :date, type:  "date", onchange:'calculateDays(this);', :value=>"#{cert.finish_date}"}
                                    %span.input-group-addon
                                      %i.fa.fa-calendar
                            %br
                            .row
                              .col-sm-12
                                #new-date 
                            .row{'class'=>'comp2'}
                              .col-sm-12
                                %label Componentes de la obra:
                                %br
                                .col-sm-8
                                  %label#get-comp
                                    %label.select.components{'class'=>'comp-check'}
                            %fieldset
                              %legend Archivos a Adjuntar
                              .row
                                .col-sm-6
                                  %label.col-sm-2 Certificado
                                  .col-sm-10
                                    .button
                                      = file_field_tag "professional[certificates_attributes][" + @reg.to_s + "][certificate]", class: 'btn btn-default', label: false, onchange: "this.parentNode.nextSibling.value = this.value", as: "file"
                                      %p.help-block
                                        - if cert.certificate.exists?
                                          = 'Archivo subido: ' + File.basename(cert.certificate.path, File.extname(cert.certificate.path))
                                .col-sm-6
                                  %label.col-sm-2 Otro
                                  .col-sm-10
                                    .button
                                      = file_field_tag "professional[certificates_attributes][" + @reg.to_s + "][other]", class: 'btn btn-default', label: false, onchange: "this.parentNode.nextSibling.value = this.value", as: "file"
                                      - if cert.other.exists?
                                        = 'Archivo subido: ' + File.basename(cert.other.path, File.extname(cert.other.path))
                        :javascript
                          function workSelectKU(element){
                            if($(element).val()==''){
                              $(element).parent().parent().parent().children('.comp2.row').children('.col-sm-6').children('.col-sm-4').children('#get-comp').children('.comp-check.components.select').html('');
                              $(element).parent().parent().children().children('.start_certificate').find('input').empty();
                              $(element).parent().parent().children().children('.start_certificate').find('input').val('');
                              $(element).parent().parent().children().children('.finish_certificate').find('input').empty();
                              $(element).parent().parent().children().children('.finish_certificate').find('input').val('');
                              $(element).parent().parent().parent().children('.2.row').children('.col-sm-4').children('.entity.input-group').find('input').empty();
                              $(element).parent().parent().parent().children('.2.row').children('.col-sm-4').children('.entity.input-group').find('input').val('');
                              $(element).parent().parent().parent().children('.2.row').children('.col-sm-4').children('.contractor.input-group').find('input').empty();
                              $(element).parent().parent().parent().children('.2.row').children('.col-sm-4').children('.contractor.input-group').find('input').val('');
                            }else{
                              var work_id = $(element).val();
                              complete_infocombo(element, "#{get_component_from_work_biddings_professionals_path}", work_id, "#{form_authenticity_token}", 0);
                            }
                          }
                          
                          function complete_infocombo(element, url, work_id, form_token, default_value){
                            var str_html = "";
                            $.ajax({
                                type: "POST",
                                url: url,
                                async: false,
                                data: { work_id: work_id, authenticity_token: form_token}
                            }).done(function( data ) {
                              var start = data.start;
                              var finish = data.finish;
                              var entity = data.entity;
                              var contractor = data.contractor;
                              newOptions = [];
                              $.each(data.component_work, function(key, value){
                                item = {};
                                item['name'] = value.name;
                                item['id'] = value.id;
                                newOptions.push(item);
                              });
                              $(element).parent().parent().parent().children('.comp2.row').children('.col-sm-6').children('.col-sm-4').children('#get-comp').children('.comp-check.components.select').empty();
                              $.each(newOptions, function(key,value){
                                str_html = str_html + "<label> <strong> > </strong> " + value.name + "</label><br/>"
                              });
                              $(element).parent().parent().parent().children('.comp2.row').children('.col-sm-12').children('.col-sm-8').children('#get-comp').children('.comp-check.components.select').html(str_html);
                              $(element).parent().parent().children().children('.start_certificate').find('input').empty();
                              $(element).parent().parent().children().children('.start_certificate').find('input').val(start);
                              $(element).parent().parent().children().children('.finish_certificate').find('input').empty();
                              $(element).parent().parent().children().children('.finish_certificate').find('input').val(finish);
                              $(element).parent().parent().parent().children('.2.row').children('.col-sm-4').children('.entity.input-group').find('input').empty();
                              $(element).parent().parent().parent().children('.2.row').children('.col-sm-4').children('.entity.input-group').find('input').val(entity);
                              $(element).parent().parent().parent().children('.2.row').children('.col-sm-4').children('.contractor.input-group').find('input').empty();
                              $(element).parent().parent().parent().children('.2.row').children('.col-sm-4').children('.contractor.input-group').find('input').val(contractor);
                            });
                          }
                      - @reg = @reg + 1
      #tab3.tab-pane
        %br/
        %h3
          %strong Paso 3
          \- Capacitaciones
        .row
          .col-md-4
            %a.btn.btn-labeled.btn-success{ :href => 'javascript:void(0);', :onclick => 'add_trainings();'}
              %span.btn-label
                %i.fa.fa-plus
              Añadir Capacitaciones
        #wid-id-10.jarviswidget.jarviswidget-color-blueLight{"data-widget-colorbutton" => "false", "data-widget-custombutton" => "false", "data-widget-deletebutton" => "false", "data-widget-editbutton" => "false", "data-widget-fullscreenbutton" => "false", "data-widget-sortable" => "false", "data-widget-togglebutton" => "false"}
          %div
            .widget-body.no-padding
              #accordion-tr.panel-group.smart-accordion-default
                - if @action=="edit"
                  -@professional.trainings.each do |tra|
                    = hidden_field_tag 'professional[trainings_attributes][' + @reg.to_s + '][id]', tra.id
                    = hidden_field_tag 'professional[trainings_attributes][' + @reg.to_s + '][professional_id]', @professional.id
                    .panel.panel-default
                      .panel-heading
                        %h4.panel-title
                          %a{"data-parent" => "#accordion-tr", "data-toggle" => "collapse", href: "#collapse" + @reg.to_s + "-2"}
                            %i.fa.fa-fw.fa-plus-circle.txt-color-green
                            %i.fa.fa-fw.fa-minus-circle.txt-color-red
                            Capacitación N°1
                          %div{"style"=>"width: 50px; float: right; color: white; background: #2070a8;  text-align: center;"}
                            = check_box_tag 'professional[trainings_attributes][' + @reg.to_s  + '][_destroy]'
                      .panel-collapse.collapse.in{ 'id'=> "collapse" + @reg.to_s + "-2"}
                        .panel-body
                          .row
                            .col-sm-4
                              %label Tipo de capacitación
                              %br
                              %select.form-control{name: "professional[trainings_attributes][" + @reg.to_s + "][type_training]"}
                                -if tra.type_training=="Curso"
                                  %option{value: "Curso", selected:true} Curso
                                  %option{value: "Diplomado"} Diplomado
                                  %option{value: "Doctorado"} Doctorado
                                  %option{value: "Maestría"} Maestría
                                -if tra.type_training=="Diplomado"
                                  %option{value: "Curso"} Curso
                                  %option{value: "Diplomado", selected:true} Diplomado
                                  %option{value: "Doctorado"} Doctorado
                                  %option{value: "Maestría"} Maestría
                                -if tra.type_training=="Doctorado"
                                  %option{value: "Curso"} Curso
                                  %option{value: "Diplomado"} Diplomado
                                  %option{value: "Doctorado", selected:true} Doctorado
                                  %option{value: "Maestría"} Maestría
                                -if tra.type_training=="Maestría"
                                  %option{value: "Curso"} Curso
                                  %option{value: "Diplomado"} Diplomado
                                  %option{value: "Doctorado"} Doctorado
                                  %option{value: "Maestría", selected:true} Maestría
                            .col-sm-6
                              %label Nombre de curso
                              %br
                              .input-group
                                %input.form-control{ name:"professional[trainings_attributes][" + @reg.to_s + "][name_training]", placeholder: "Nombre del curso", :value=> "#{tra.name_training}", html: { class: 'form-control' }}
                                %span.input-group-addon
                                  %i.fa.fa-book.fa-sm.fa-fw
                          %br          
                          .row
                            .col-sm-4
                              %label Fecha de Inicio
                              .input-group
                                %input#finish.form-control{ name:"professional[trainings_attributes][" + @reg.to_s + "][start_training]",as: :string, :value=>"#{tra.start_training}", type: "date"}
                                %span.input-group-addon
                                  %i.fa.fa-calendar
                            .col-sm-4
                              %label Fecha de Termino
                              .input-group
                                %input#finish.form-control{ name:"professional[trainings_attributes][" + @reg.to_s + "][finish_training]", as: :string, type: "date", :value => "#{tra.finish_training}"}
                                %span.input-group-addon
                                  %i.fa.fa-calendar
                            .col-sm-4
                              %label Número de horas
                              .input-group
                                %span.input-group-addon
                                  %i.icon-append.fa.fa-book
                                %input.form-control{ name:"professional[trainings_attributes][" + @reg.to_s + "][num_hours]", placeholder: "Número de horas",:value => "#{tra.num_hours}", input_html: { class: 'form-control' }}
                          %br
                          %fieldset
                            %legend Archivos a Adjuntar
                            .row
                              .col-sm-6
                                %label.col-sm-2 Certificado de Capacitación
                                .col-sm-10
                                  = file_field_tag "professional[trainings_attributes][" + @reg.to_s + "][training]", class: 'btn btn-default', label: false, onchange: "this.parentNode.nextSibling.value = this.value", as: "file"
                                  - if tra.training.exists?
                                    = 'Archivo subido: ' + File.basename(tra.training.path, File.extname(tra.training.path))
                    - @reg = @reg + 1
      #tab4.tab-pane
        %br/
        %h3
          %strong Paso 4
          \- Guardar Formulario
        %br/
        %h1.text-center.text-success
          %strong
            %i.fa.fa-check.fa-lg
            Completo
        %h4.text-center Haga click en siguiente para finalizar
        %br/
        %footer
          %button.btn.btn-primary#save-professional.btn-center{type: "submit"}
            %i.fa.fa-save
              Guardar
        %br/

      .form-actions
        .row
          .col-sm-12
            %ul.pager.wizard.no-margin
              %li.previous.disabled
                %a.btn.btn-lg.btn-default{href: "javascript:void(0);"} Previous
              %li.next
                %a.btn.btn-lg.txt-color-darken{href: "javascript:void(0);"} Next