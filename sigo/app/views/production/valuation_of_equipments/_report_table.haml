#wid-id-0.jarviswidget.jarviswidget-color-blueDark{"data-widget-editbutton" => "false", "data-widget-deletebutton" => "false"}
  %header
    %span.widget-icon
      %i.fa.fa-table
    %h2
      Valorización de Equipo
    %br

  %div
    .jarviswidget-editbox
    .widget-body
      %table.table.table-bordered{"style"=>"width:40%"}
        %thead
          %tr
            %th{'colspan' => 4, "style"=>"color:#5f5f5f"}= @subcontractequipment.entity.name + ' ' + @numbercode
          %tr
            %th{"style"=>"color:#5f5f5f"} Monto contratado
            %th{"style"=>"color:#5f5f5f"} Adelanto
            %th{"style"=>"color:#5f5f5f"} Amortización Acumulada
            %th{"style"=>"color:#5f5f5f"} Saldo
        %tbody
          %th{"style"=>"color:#5f5f5f"}= @subcontractequipment.contract_amount
          %th{"style"=>"color:#5f5f5f"}= @subadvances
          %th{"style"=>"color:#5f5f5f"} 3
          %th{"style"=>"color:#5f5f5f"}= @balance

  %div
    .jarviswidget-editbox
    .widget-body
      %table.table.table-bordered
        %thead
          %tr
            %th{"style"=>"color:#5f5f5f"} Item
            %th{"style"=>"color:#5f5f5f"} Descripcion
            %th{ 'colspan' => 2, "style"=>"color:#5f5f5f"} Actual
            %th{"style"=>"color:#5f5f5f"} Acumulado Anterior
            %th{"style"=>"color:#5f5f5f"} Acumulado Actual
        %tbody
          %tr
            %th{"style"=>"color:#5f5f5f"} 1.00
            %th{"style"=>"color:#5f5f5f"} Valorización sin IGV
            %th{"style"=>"color:#5f5f5f"}
            %th{"style"=>"color:#5f5f5f"}= @totalprice
            %th{"style"=>"color:#5f5f5f"}
            %th{"style"=>"color:#5f5f5f"}
          %tr
            %th{"style"=>"color:#5f5f5f"} 2.00
            %th{"style"=>"color:#5f5f5f"} 
              Amortización de Adelanto (SIN. I.G.V.)
              %br
              %input#flag{:type =>"checkbox", :onchange => 'check();'} Usar IGV
            %th{"style"=>"color:#5f5f5f"}
              %input.form-control#percent{:value => "#{@initial_amortization_percent}", :readonly => true, "style"=> "width: 40%", :onkeypress => "return isNumber(event);",  onchange: "this.value = minmax(this.value, 1, 100)"}%
            %th{"style"=>"color:#5f5f5f"}
              %input.form-control#number{:value => "#{@subcontractequipment.initial_amortization_number}", "style"=> "width: 50%", :onkeypress => "return isNumber(event);",  onchange: "this.value = minmax(this.value, 1, 100)"}
            %th{"style"=>"color:#5f5f5f"}
            %th{"style"=>"color:#5f5f5f"}
          %tr
            %th{"style"=>"color:#5f5f5f"} 3.00
            %th{"style"=>"color:#5f5f5f"} Total a Facturar
            %th{ 'colspan' => 2, "style"=>"color:#5f5f5f"}= @bill
            %th{"style"=>"color:#5f5f5f"}
            %th{"style"=>"color:#5f5f5f"}
          %tr
            %th{"style"=>"color:#5f5f5f"} 4.00
            %th{"style"=>"color:#5f5f5f"} I.G.V. del Total a Facturar
            %th{"style"=>"color:#5f5f5f"}= @billigv
            %th{"style"=>"color:#5f5f5f"}
            %th{"style"=>"color:#5f5f5f"}
            %th{"style"=>"color:#5f5f5f"}
          %tr
            %th{"style"=>"color:#5f5f5f"}
            %th{"style"=>"color:#5f5f5f"} Total Incluido IGV
            %th{ 'colspan' => 2, "style"=>"color:#5f5f5f"}= @bill-@billigv
            %th{"style"=>"color:#5f5f5f"}
            %th{"style"=>"color:#5f5f5f"}
          %tr
            %th{"style"=>"color:#5f5f5f"} 5.00
            %th{"style"=>"color:#5f5f5f"} Retenciones
            %th{ 'colspan' => 2, "style"=>"color:#5f5f5f"}
            %th{"style"=>"color:#5f5f5f"}
            %th{"style"=>"color:#5f5f5f"}
          %tr
            %th{"style"=>"color:#5f5f5f"} 5.01
            %th{"style"=>"color:#5f5f5f"} Detracción del Total (Incl. I.G.V.)
            %th{"style"=>"color:#5f5f5f"}
            %th{"style"=>"color:#5f5f5f"}= @subcontractequipment.detraction
            %th{"style"=>"color:#5f5f5f"}
            %th{"style"=>"color:#5f5f5f"}
          %tr
            %th{"style"=>"color:#5f5f5f"} 5.02
            %th{"style"=>"color:#5f5f5f"} Descuento de Combustible
            %th{ 'colspan' => 2, "style"=>"color:#5f5f5f"}= @fuel_discount
            %th{"style"=>"color:#5f5f5f"}
            %th{"style"=>"color:#5f5f5f"}= @accumulated_fuel_discount
          %tr
            %th{"style"=>"color:#5f5f5f"} 5.03
            %th{"style"=>"color:#5f5f5f"} Descuento de Otros (Incl. I.G.V.)
            %th{"style"=>"color:#5f5f5f"}
            %th{"style"=>"color:#5f5f5f"}                            
              = text_field_tag 'scValuation[igv]', '5', class: "form-control amount-item"
            %th{"style"=>"color:#5f5f5f"}
            %th{"style"=>"color:#5f5f5f"}
          %tr
            %th{"style"=>"color:#5f5f5f"}
            %th{"style"=>"color:#5f5f5f"} TOTAL RETENCIONES
            %th{ 'colspan' => 2, "style"=>"color:#5f5f5f"}= @subcontractequipment.detraction.to_i+@fuel_discount.to_i
            %th{"style"=>"color:#5f5f5f"}
            %th{"style"=>"color:#5f5f5f"}
          %tr
            %th{"style"=>"color:#5f5f5f"} 06
            %th{"style"=>"color:#5f5f5f"} NETO A PAGAR
            %th{ 'colspan' => 2, "style"=>"color:#5f5f5f"}
            %th{"style"=>"color:#5f5f5f"}
            %th{"style"=>"color:#5f5f5f"}

    %footer
      %button.btn.btn-primary{type: "submit"}
        %i.fa.fa-save
          Guardar

:javascript

  $(document).ready(function(){
    if($('#percent').val()!=0){
      $("#flag").attr('checked', true);
      check();
    }    
  });

  function check(){
    $('#percent').attr("readonly", !$('#flag').is(':checked'));
    $('#number').attr("disabled", $('#flag').is(':checked'));
  }

  $('#percent').change(function(){
    if($('#total').text()!=""){
      $('#number').val(' ');
      var num = parseInt($('#total').text())*$('#percent').val()/100;
      $('#number').val(num.toFixed(2));
      $('#totalfac').text(parseInt($('#total').text())- $('#number').val());
      $('#sv_valuation_initial_amortization_number').val($('#number').val());
      $('#sv_valuation_initial_amortization_percentage').val($('#percent').val());
    }else{
      $('#number').val('Verifique que el valor no sea 0');
    }
  });

  $('#number').change(function(){
    if($('#total').text()!= ""){
      $('#percent').text(' ');
      var num = $('#number').val()/parseInt($('#total').text())*100;
      $('#percent').val(num.toFixed(2));
      $('#totalfac').text(parseInt($('#total').text())- $('#number').val());
      $('#sv_valuation_initial_amortization_number').val($('#number').val());
      $('#sv_valuation_initial_amortization_percentage').val($('#percent').val());
    }else{
      $('#percent').val('Verifique que el valor no sea 0');
    }
  });

  function isNumber(evt) {
    evt = (evt) ? evt : window.event;
    var charCode = (evt.which) ? evt.which : evt.keyCode;
    if (charCode > 47 && charCode < 58 || charCode==46) {
      return true;
    }else{
      return false;
    }
  }

  function minmax(value, min, max){
    if($('#flag').is(':checked')){
      max = 100;
    }else{
      max = parseFloat($('#total').text());
    }
    
    if(parseInt(value) < min || isNaN(value)) 
      return min; 
    else if(parseInt(value) > max) 
      return max; 
    else return value;
  }
