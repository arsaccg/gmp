%header
  %br

  %div
    .widget-body
      %table.panel.panel-primary{ style: "height: 90px; width: 850px;margin: 0 auto" }
        %thead.panel-heading
          %tr
            %th{'colspan' => 4, "style"=>"text-align:center;font-size: large"}=@valuationofequipment.name.to_s+" - VALORIZACIÓN N°"+ ' ' + @valuationofequipment.code

        %tbody
          %tr{"bgcolor"=>"#3276B1"}
            %th{"style"=>"color:white;text-align:center;width: 15%"} Monto contratado
            %th{"style"=>"color:white;text-align:center"} Adelanto
            %th{"style"=>"color:white;text-align:center"} Amortización Acumulada
            %th{"style"=>"color:white;text-align:center"} Saldo
          %th{"style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@valuationofequipment.hired_amount, unit: 'S/. ', precision: 2)
          %th{"style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@valuationofequipment.advances, unit: 'S/. ', precision: 2)     
          %th{"style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@valuationofequipment.accumulated_amortization, unit: 'S/. ', precision: 2)
          %th{"style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@valuationofequipment.balance, unit: 'S/. ', precision: 2)
  %br
  %div
    .widget-body
      %h1{"style"=>"font-size: large;color:#5f5f5f; font-weight:bold;text-align:center;"}
        = "SEMANA N° #{@inicio[0].split[1].to_s} - #{@fin[0].split[1].to_s} / DEL #{@start_date.to_date.strftime('%d-%m-%y')} AL #{@end_date.to_date.strftime('%d-%m-%y')}"

      %table.panel.panel-primary.table-bordered{ style: "height: 530px;width: 850px;margin: 0 auto" }
        %thead.panel-heading

          %tr{"bgcolor"=>"#3276B1",style: "height: 45px;"}
            %th{"style"=>"color:white;text-align:center"} Item
            %th{"style"=>"color:white;text-align:center"} Descripcion
            %th{ 'colspan' => 2, "style"=>"color:white;text-align:center"} Actual
            %th{"style"=>"color:white;text-align:center"} Acumulado Anterior
            %th{"style"=>"color:white;text-align:center"} Acumulado Actual

        %tbody
          %tr{"bgcolor"=>"#ECF3F8"}
            %th{"style"=>"color:#5f5f5f;text-align:center"} 1.00
            %th{"style"=>"color:#5f5f5f;padding-left:8px;"}
              ="Valorización sin IGV"
              %span{"style"=>"width=20px;float:right;padding-right:11px;"}
                %a#boton1.btn.btn-xs.btn-danger{href: 'javascript:void(0);', :onclick => 'part_equipment();',"data-toggle" => "tooltip", :title => "Detalle de Equipos"}
                  %i.fa.fa-list-ol{"style"=>"color:white"}            
            %th{'colspan'=>2,"style"=>"color:#5f5f5f;text-align:right;padding-right:5px;;vertical-align: middle"}= number_to_currency(@valuationofequipment.valuation, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:right;padding-right:5px;;vertical-align: middle"}= number_to_currency(@valorizacionsinigv, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:right;padding-right:5px;;vertical-align: middle"}= number_to_currency(@valuationofequipment.accumulated_valuation, unit: 'S/. ', precision: 2)
          %tr
            %th{"style"=>"color:#5f5f5f;text-align:center"} 2.00
            %th{"style"=>"color:#5f5f5f;padding-left:8px;"} 
              ="Amortización de Adelanto (SIN. I.G.V.)"
              %span{"style"=>"color:#5f5f5f;float:right;padding-right:8px;"}=sprintf('%.2f',@valuationofequipment.initial_amortization_percentage.to_f)
            %th{'colspan'=>2,"style"=>"color:#5f5f5f;text-align:right;padding-right:5px;"}= number_to_currency(@valuationofequipment.initial_amortization_number, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:right;padding-right:5px;"}= number_to_currency(@amortizaciondeadelanto, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:right;padding-right:5px;"}= number_to_currency(@valuationofequipment.accumulated_initial_amortization_number, unit: 'S/. ', precision: 2)
          %tr{"bgcolor"=>"#ECF3F8"}
            %th{"style"=>"color:#5f5f5f;text-align:center"} 3.00
            %th{"style"=>"color:#5f5f5f;padding-left:8px;"} Total a Facturar
            %th{ 'colspan' => 2, "style"=>"color:#5f5f5f;text-align:right;padding-right:5px;"}= number_to_currency(@valuationofequipment.bill, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:right;padding-right:5px;"}= number_to_currency(@totalfacturar, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:right;padding-right:5px;"}= number_to_currency(@valuationofequipment.accumulated_bill, unit: 'S/. ', precision: 2)
          %tr
            %th{"style"=>"color:#5f5f5f;text-align:center"} 4.00
            %th{"style"=>"color:#5f5f5f;padding-left:8px;"} I.G.V. del Total a Facturar
            %th{ 'colspan' => 2, "style"=>"color:#5f5f5f;text-align:right;padding-right:5px;"}= number_to_currency(@valuationofequipment.billigv, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:right;padding-right:5px;"}= number_to_currency(@totalfacigv, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:right;padding-right:5px;"}= number_to_currency(@valuationofequipment.accumulated_billigv, unit: 'S/. ', precision: 2)
          %tr{"bgcolor"=>"#3276B1"}
            %th{"style"=>"color:white"}
            %th{"style"=>"color:white;padding-left:8px;"} Total Incluido IGV
            %th{ 'colspan' => 2, "style"=>"color:white;text-align:right;padding-right:5px;"}= number_to_currency(@valuationofequipment.totalbill, unit: 'S/. ', precision: 2) 
            %th{"style"=>"color:white;text-align:right;padding-right:5px;"}= number_to_currency(@totalincluidoigv, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:white;text-align:right;padding-right:5px;"}= number_to_currency(@valuationofequipment.accumulated_totalbill, unit: 'S/. ', precision: 2)
          %tr{"bgcolor"=>"#ECF3F8"}
            %th{"style"=>"color:#5f5f5f;text-align:center"} 5.00
            %th{ 'colspan' => 5, "style"=>"color:#5f5f5f;padding-left:8px;"} Retenciones
          %tr
            %th{"style"=>"color:#5f5f5f;text-align:center;padding-left:15px;"} 5.01
            %th{"style"=>"color:#5f5f5f;padding-left:18px;"}= "Detracción del Total (Incl. I.G.V.) ("+@valuationofequipment.detraction.to_s+"%)"
            %th{ 'colspan' => 2, "style"=>"color:#5f5f5f;text-align:right;padding-right:5px;"}= number_to_currency((@valuationofequipment.totalbill.to_f*@valuationofequipment.detraction.to_f/100).round, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:right;padding-right:5px;"}= number_to_currency(@detraccion, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:right;padding-right:5px;"}= number_to_currency(@valuationofequipment.accumulated_detraction, unit: 'S/. ', precision: 2)
          %tr
            %th{"style"=>"color:#5f5f5f;text-align:center;padding-left:15px;"} 5.02
            %th{"style"=>"color:#5f5f5f;padding-left:18px;"} Descuento de Combustible (Incl. I.G.V.)
            %th{ 'colspan' => 2, "style"=>"color:#5f5f5f;text-align:right;padding-right:5px;"}= number_to_currency(@valuationofequipment.fuel_discount, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:right;padding-right:5px;"}= number_to_currency(@descuentocombustible, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:right;padding-right:5px;"}= number_to_currency(@valuationofequipment.accumulated_fuel_discount, unit: 'S/. ', precision: 2)
          %tr
            %th{"style"=>"color:#5f5f5f;text-align:center;padding-left:15px;"} 5.03
            %th{"style"=>"color:#5f5f5f;padding-left:18px;"} Descuento de Otros (Incl. I.G.V.)
            %th{ 'colspan' => 2, "style"=>"color:#5f5f5f;text-align:right;padding-right:5px;"}= number_to_currency(@valuationofequipment.other_discount, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:right;padding-right:5px;"}= number_to_currency(@otrosdescuentos, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:right;padding-right:5px;"}= number_to_currency(@valuationofequipment.accumulated_other_discount, unit: 'S/. ', precision: 2)
          %tr{"bgcolor"=>"#ECF3F8"}
            %th{"style"=>"color:#5f5f5f"}
            %th{"style"=>"color:#5f5f5f;padding-left:18px;"} TOTAL RETENCIONES
            %th{ 'colspan' => 2, "style"=>"color:#5f5f5f;text-align:right;padding-right:5px;"}= number_to_currency(@valuationofequipment.retention, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:right;padding-right:5px;"}= number_to_currency(@retenciones, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:right;padding-right:5px;"}= number_to_currency(@valuationofequipment.accumulated_retention.to_i, unit: 'S/. ', precision: 2)
          %tr{"bgcolor"=>"#3276B1"}
            %th{"style"=>"color:white;text-align:center"} 6.00
            %th{"style"=>"color:white;padding-left:8px;"} NETO A PAGAR: TOTAL (INCL. I.G.V.) - TOTAL RETEN.
            %th{ 'colspan' => 2, "style"=>"color:white;text-align:right;padding-right:5px;"}= number_to_currency(@valuationofequipment.net_payment, unit: 'S/. ', precision: 2)          
            %th{"style"=>"color:white;text-align:right;padding-right:5px;"}= number_to_currency(@netoapagar, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:white;text-align:right;padding-right:5px;"}= number_to_currency(@valuationofequipment.accumulated_net_payment, unit: 'S/. ', precision: 2)
      %br
      %br
      - case @valuationofequipment.state
        - when 'disapproved'
          %a.btn.btn-success.btn-xs#aprove{type: "button", style: "float:right;margin-right:11%;width:100px;"}
            %i.fa.fa-check>
              Aprobar
    %br
    %br
    #part-equipment.modal.fade{"aria-hidden" => "true", "aria-labelledby" => "partPeopleLabel", role: "dialog", tabindex: "-1"}    
    #report-equipment.modal.fade{"aria-hidden" => "true", "aria-labelledby" => "partPeopleLabel", role: "dialog", tabindex: "-1"}
%br
%button.btn.btn-sm.btn-primary.btn-prev#backlist{type: "button"}
  %i.fa.fa-arrow-left>
  Retornar al listado de Valorizaciones de Equipo
:javascript

  $('#backlist').click(function(){
      load_url_ajax("#{production_valuation_of_equipments_path}", 'content', {company_id: '#{@company}'}, null, 'GET');
  });
  $('#aprove').click(function(){
      load_url_ajax('#{approve_production_sc_valuation_path(@valuationofequipment.id)}', 'content', {company_id: '#{@company}', start_date: '#{@valuationofequipment.start_date}', end_date: '#{@valuationofequipment.end_date}'}, null, 'GET');
  });

  function part_equipment(id) {
    data = { authenticity_token: "#{form_authenticity_token}", start_date: "#{@valuationofequipment.start_date}", end_date: "#{@valuationofequipment.end_date}", cad: "#{@valuationofequipment.working_group}", name: "#{@valuationofequipment.name}", code: "#{@valuationofequipment.code}", ids: "#{@ids}" };
    load_url_ajax('#{part_equipment_production_valuation_of_equipments_path}', 'part-equipment', data, '', 'POST');
    $('#part-equipment').modal({
      keyboard: false,
      backdrop: 'static'
    });
  }