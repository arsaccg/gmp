%header
  %h2
    Valorizacion de Equipo
  %br
    - case @valuationofequipment.state
      - when 'disapproved'
        %a.btn.btn-success.btn-xs#aprove{type: "button"}
          %i.fa.fa-check>
            Aprobar
  %div
    .widget-body
      %table.table.table-bordered{ style: "width: 850px;margin: 0 auto" }
        %thead
          %tr
            %th{'colspan' => 4, "style"=>"color:#5f5f5f;text-align:center;font-size: large"}= "VALORIZACIÓN N°"+ ' ' + @valuationofequipment.code
          %tr
            %th{"style"=>"color:#5f5f5f;text-align:center;"} OBRA:
            %th{'colspan' => 3, "style"=>"color:#5f5f5f;"}= CostCenterDetail.find_by_cost_center_id(@cc).name.to_s
          %tr
            %th{"style"=>"color:#5f5f5f;text-align:center;"} Contratista:
            %th{'colspan' => 3, "style"=>"color:#5f5f5f;"}= @valuationofequipment.name.to_s
          %tr
            %th{"style"=>"color:#5f5f5f;text-align:center;"} Razón Social:
            %th{'colspan' => 3, "style"=>"color:#5f5f5f;"}= @valuationofequipment.name.to_s
          %tr
            %th{"style"=>"color:#5f5f5f;text-align:center;"} RUC:
            %th{'colspan' => 3, "style"=>"color:#5f5f5f;"}= Entity.find_by_name(@valuationofequipment.name).ruc.to_s
          %tr
            %th{"style"=>"color:#5f5f5f;text-align:center;width: 15%"} Monto contratado
            %th{"style"=>"color:#5f5f5f;text-align:center"} Adelanto
            %th{"style"=>"color:#5f5f5f;text-align:center"} Amortización Acumulada
            %th{"style"=>"color:#5f5f5f;text-align:center"} Saldo
        %tbody
          %th{"style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@valuationofequipment.hired_amount, unit: 'S/. ', precision: 2)
          %th{"style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@valuationofequipment.advances, unit: 'S/. ', precision: 2)     
          %th{"style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@valuationofequipment.accumulated_amortization, unit: 'S/. ', precision: 2)
          %th{"style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@valuationofequipment.balance, unit: 'S/. ', precision: 2)
  %br
  %div
    .widget-body
      %table.table.table-bordered{ style: "width: 850px;margin: 0 auto" }
        %thead
          %tr
            %th{ 'colspan' => 6, "style"=>"color:#5f5f5f;text-align:center"}= "SEMANA N° #{@inicio[0].split[1].to_s} - #{@fin[0].split[1].to_s} / DEL #{@start_date.to_date.strftime('%d-%m-%y')} AL #{@end_date.to_date.strftime('%d-%m-%y')}" 
          %tr
            %th{"style"=>"color:#5f5f5f;text-align:center"} Item
            %th{"style"=>"color:#5f5f5f;text-align:center"} Descripcion
            %th{ 'colspan' => 2, "style"=>"color:#5f5f5f;text-align:center"} Actual
            %th{"style"=>"color:#5f5f5f;text-align:center"} Acumulado Anterior
            %th{"style"=>"color:#5f5f5f;text-align:center"} Acumulado Actual
        %tbody
          %tr
            %th{"style"=>"color:#5f5f5f"} 1.00
            %th{"style"=>"color:#5f5f5f"} Valorización sin IGV
            %th{"style"=>"color:#5f5f5f;text-align:center"}
              %span{"style"=>"width=20px"}
                %a.btn.bg-color-blueDark{href: 'javascript:void(0);', :onclick => "part_equipment(#{@valuationofequipment.id});"}
                  %i.fa.fa-list-alt.fa-md.fa-fw{"style"=>"color:white"}
            %th{"style"=>"color:#5f5f5f;text-align:center;vertical-align: middle"}= number_to_currency(@valuationofequipment.valuation, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:center;vertical-align: middle"}= number_to_currency(@valorizacionsinigv, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:center;vertical-align: middle"}= number_to_currency(@valuationofequipment.accumulated_valuation, unit: 'S/. ', precision: 2)
          %tr
            %th{"style"=>"color:#5f5f5f"} 2.00
            %th{"style"=>"color:#5f5f5f"} Amortización de Adelanto (SIN. I.G.V.)
            %th{"style"=>"color:#5f5f5f;text-align:center"}=sprintf('%.2f',@valuationofequipment.initial_amortization_percentage.to_f)
            %th{"style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@valuationofequipment.initial_amortization_number, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@amortizaciondeadelanto, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@valuationofequipment.accumulated_initial_amortization_number, unit: 'S/. ', precision: 2)
          %tr
            %th{"style"=>"color:#5f5f5f"} 3.00
            %th{"style"=>"color:#5f5f5f"} Total a Facturar
            %th{ 'colspan' => 2, "style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@valuationofequipment.bill, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@totalfacturar, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@valuationofequipment.accumulated_bill, unit: 'S/. ', precision: 2)
          %tr
            %th{"style"=>"color:#5f5f5f"} 4.00
            %th{"style"=>"color:#5f5f5f"} I.G.V. del Total a Facturar
            %th{ 'colspan' => 2, "style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@valuationofequipment.billigv, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@totalfacigv, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@valuationofequipment.accumulated_billigv, unit: 'S/. ', precision: 2)
          %tr
            %th{"style"=>"color:#5f5f5f"}
            %th{"style"=>"color:#5f5f5f"} Total Incluido IGV
            %th{ 'colspan' => 2, "style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@valuationofequipment.totalbill, unit: 'S/. ', precision: 2) 
            %th{"style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@totalincluidoigv, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@valuationofequipment.accumulated_totalbill, unit: 'S/. ', precision: 2)
          %tr
            %th{"style"=>"color:#5f5f5f"} 5.00
            %th{ 'colspan' => 5, "style"=>"color:#5f5f5f"} Retenciones
          %tr
            %th{"style"=>"color:#5f5f5f"} 5.01
            %th{"style"=>"color:#5f5f5f"} Detracción del Total (Incl. I.G.V.)
            %th{ 'colspan' => 2, "style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@valuationofequipment.detraction, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@detraccion, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@valuationofequipment.accumulated_detraction, unit: 'S/. ', precision: 2)
          %tr
            %th{"style"=>"color:#5f5f5f"} 5.02
            %th{"style"=>"color:#5f5f5f"} Descuento de Combustible (Incl. I.G.V.)
            %th{ 'colspan' => 2, "style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@valuationofequipment.fuel_discount, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@descuentocombustible, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@valuationofequipment.accumulated_fuel_discount, unit: 'S/. ', precision: 2)
          %tr
            %th{"style"=>"color:#5f5f5f"} 5.03
            %th{"style"=>"color:#5f5f5f"} Descuento de Otros (Incl. I.G.V.)
            %th{ 'colspan' => 2, "style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@valuationofequipment.other_discount, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@otrosdescuentos, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@valuationofequipment.accumulated_other_discount, unit: 'S/. ', precision: 2)
          %tr
            %th{"style"=>"color:#5f5f5f"}
            %th{"style"=>"color:#5f5f5f"} TOTAL RETENCIONES
            %th{ 'colspan' => 2, "style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@valuationofequipment.retention, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@retenciones, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@valuationofequipment.accumulated_retention, unit: 'S/. ', precision: 2)
          %tr
            %th{"style"=>"color:#5f5f5f"} 6.00
            %th{"style"=>"color:#5f5f5f"} NETO A PAGAR: TOTAL (INCL. I.G.V.) - TOTAL RETEN.
            %th{ 'colspan' => 2, "style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@valuationofequipment.net_payment, unit: 'S/. ', precision: 2)          
            %th{"style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@netoapagar, unit: 'S/. ', precision: 2)
            %th{"style"=>"color:#5f5f5f;text-align:center"}= number_to_currency(@valuationofequipment.accumulated_net_payment, unit: 'S/. ', precision: 2)
    %br
    %br
    #part-equipment.modal.fade{"aria-hidden" => "true", "aria-labelledby" => "partPeopleLabel", role: "dialog", tabindex: "-1"}    
    #report-equipment.modal.fade{"aria-hidden" => "true", "aria-labelledby" => "partPeopleLabel", role: "dialog", tabindex: "-1"}
%br
%button.btn.btn-sm.btn-primary.btn-prev#backlist{type: "button"}
  %i.fa.fa-arrow-left>
  Retornar al listado de Valorisaciones de Equipo
:javascript

  $('#backlist').click(function(){
      load_url_ajax("#{production_valuation_of_equipments_path}", 'content', {company_id: '#{@company}'}, null, 'GET');
  });
  $('#aprove').click(function(){
      load_url_ajax('#{approve_production_sc_valuation_path(@valuationofequipment.id)}', 'content', {company_id: '#{@company}', start_date: '#{@valuationofequipment.start_date}', end_date: '#{@valuationofequipment.end_date}'}, null, 'GET');
  });

  function part_equipment(id) {
    data = { authenticity_token: "#{form_authenticity_token}", start_date: "#{@valuationofequipment.start_date}", end_date: "#{@valuationofequipment.end_date}", cad: "#{@valuationofequipment.working_group}", name: "#{@valuationofequipment.name}", code: "#{@valuationofequipment.code}", id:id };
    load_url_ajax('#{part_equipment_production_valuation_of_equipments_path}', 'part-equipment', data, '', 'POST');
    $('#part-equipment').modal({
      keyboard: false,
      backdrop: 'static'
    });
  }